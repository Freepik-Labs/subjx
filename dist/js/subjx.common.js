/*@license
* Drag/Rotate/Resize Library
* Released under the MIT license, 2018-2020
* Karen Sarksyan
* nichollascarter@gmail.com
*/
"use strict";const t=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(t){clearTimeout(t)},{forEach:s,slice:o,map:r,reduce:n}=Array.prototype,{warn:a}=console,i=t=>null!=t,c=t=>null==t,l=t=>"function"==typeof t,h=t=>l(t)?function(){t.call(this,...arguments)}:()=>{};class u{constructor(t){if("string"==typeof t){const e=document.querySelectorAll(t);this.length=e.length;for(let t=0;t<this.length;t++)this[t]=e[t]}else if("object"!=typeof t||1!==t.nodeType&&t!==document)if(t instanceof u){this.length=t.length;for(let e=0;e<this.length;e++)this[e]=t[e]}else{if(!i(e=t)||"object"!=typeof e||!(Array.isArray(e)||i(window.Symbol)&&"function"==typeof e[window.Symbol.iterator]||i(e.forEach)||"number"==typeof e.length&&(0===e.length||e.length>0&&e.length-1 in e)))throw new Error("Passed parameter must be selector/element/elementArray");this.length=0;for(let e=0;e<this.length;e++)1===t.nodeType&&(this[e]=t[e],this.length++)}else this[0]=t,this.length=1;var e}css(t){const e={setStyle(t){return((t,e)=>{let s=t.length;for(;s--;)for(const o in e)t[s].style[o]=e[o];return t.style})(this,t)},getStyle(){return(e=>{let s=e.length;for(;s--;)return e[s].currentStyle?e[s].currentStyle[t]:document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e[s],"")[t]:e[s].style[t]})(this)}};return"string"==typeof t?e.getStyle.apply(this,o.call(arguments,1)):"object"!=typeof t&&t?(a(`Method ${t} does not exist`),!1):e.setStyle.apply(this,arguments)}on(){let t=this.length;for(;t--;)this[t].events||(this[t].events={},this[t].events[arguments[0]]=[]),"string"!=typeof arguments[1]?document.addEventListener?this[t].addEventListener(arguments[0],arguments[1],arguments[2]||{passive:!1}):document.attachEvent?this[t].attachEvent("on"+arguments[0],arguments[1]):this[t]["on"+arguments[0]]=arguments[1]:d(this[t],arguments[0],arguments[1],arguments[2],arguments[3],!0);return this}off(){let t=this.length;for(;t--;)this[t].events||(this[t].events={},this[t].events[arguments[0]]=[]),"string"!=typeof arguments[1]?document.removeEventListener?this[t].removeEventListener(arguments[0],arguments[1],arguments[2]):document.detachEvent?this[t].detachEvent("on"+arguments[0],arguments[1]):this[t]["on"+arguments[0]]=null:d(this[t],arguments[0],arguments[1],arguments[2],arguments[3],!1);return this}is(t){if(c(t))return!1;const e=p(t);let s=this.length;for(;s--;)if(this[s]===e[s])return!0;return!1}}function d(t,e,s,o,r,n){const a=function(t){let e=t.target;for(;e&&e!==this;)e.matches(s)&&o.call(e,t),e=e.parentNode};!0===n?document.addEventListener?t.addEventListener(e,a,r||{passive:!1}):document.attachEvent?t.attachEvent("on"+e,a):t["on"+e]=a:document.removeEventListener?t.removeEventListener(e,a,r||{passive:!1}):document.detachEvent?t.detachEvent("on"+e,a):t["on"+e]=null}function p(t){return new u(t)}class x{constructor(){this.observers={}}subscribe(t,e){const s=this.observers;return c(s[t])&&Object.defineProperty(s,t,{value:[]}),s[t].push(e),this}unsubscribe(t,e){const s=this.observers;if(i(s[t])){const o=s[t].indexOf(e);s[t].splice(o,1)}return this}notify(t,e,s){c(this.observers[t])||this.observers[t].forEach(o=>{if(e!==o)switch(t){case"onmove":o.notifyMove(s);break;case"onrotate":o.notifyRotate(s);break;case"onresize":o.notifyResize(s);break;case"onapply":o.notifyApply(s);break;case"ongetstate":o.notifyGetState(s)}})}}class f{constructor(t){this.name=t,this.callbacks=[]}registerCallback(t){this.callbacks.push(t)}removeCallback(t){const e=this.callbacks(t);this.callbacks.splice(e,1)}}class y{constructor(){this.events={}}registerEvent(t){this.events[t]=new f(t)}emit(t,e,s){this.events[e].callbacks.forEach(e=>{e.call(t,s)})}addEventListener(t,e){this.events[t].registerCallback(e)}removeEventListener(t,e){this.events[t].removeCallback(e)}}class b{constructor(t){this.el=t,this.storage=null,this.proxyMethods=null,this.eventDispatcher=new y,this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._animate=this._animate.bind(this)}enable(t){this._processOptions(t),this._init(this.el),this.proxyMethods.onInit.call(this,this.el)}disable(){m()}_init(){m()}_destroy(){m()}_processOptions(){m()}_start(){m()}_moving(){m()}_end(){m()}_animate(){m()}_drag({dx:t,dy:e,...s}){const{transform:o,fixedDeltas:r}=this._processMove(t,e),n={dx:t,dy:e,transform:o,...s,...r};this.proxyMethods.onMove.call(this,n),this._emitEvent("drag",n)}_draw(){this._animate()}_onMouseDown(t){this._start(t),p(document).on("mousemove",this._onMouseMove).on("mouseup",this._onMouseUp)}_onTouchStart(t){this._start(t.touches[0]),p(document).on("touchmove",this._onTouchMove).on("touchend",this._onTouchEnd)}_onMouseMove(t){t.preventDefault&&t.preventDefault(),this._moving(t,this.el)}_onTouchMove(t){t.preventDefault&&t.preventDefault(),this._moving(t.touches[0],this.el)}_onMouseUp(t){p(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp),this._end(t,this.el)}_onTouchEnd(t){p(document).off("touchmove",this._onTouchMove).off("touchend",this._onTouchEnd),0===t.touches.length&&this._end(t.changedTouches[0],this.el)}_emitEvent(){this.eventDispatcher.emit(this,...arguments)}on(t,e){return this.eventDispatcher.addEventListener(t,e),this}off(t,e){return this.eventDispatcher.removeEventListener(t,e),this}}const m=()=>{throw Error("Method not implemented")},g=["dragStart","drag","dragEnd","resizeStart","resize","resizeEnd","rotateStart","rotate","rotateEnd","setPointStart","setPointEnd"],v=Math.PI/180,_=(t,e)=>{if(0===e)return t;{const s=M(t,e);if(s-t<e)return s}},M=(t,e)=>0===e?t:Math.round(t/e)*e,w=(t,e=6)=>Number(t.toFixed(e)),E=t=>t.getBoundingClientRect(),j=t=>t.css("-webkit-transform")||t.css("-moz-transform")||t.css("-ms-transform")||t.css("-o-transform")||t.css("transform")||"none",k=t=>{const e=t.match(/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g);return e?e.map(t=>parseFloat(t)):[1,0,0,1,0,0]},S=(t,e)=>{if(e){if(t.classList){if(!(e.indexOf(" ")>-1))return t.classList.add(e);e.split(/\s+/).forEach(e=>t.classList.add(e))}return t}},T=(t,e)=>{if(e){if(t.classList){if(!(e.indexOf(" ")>-1))return t.classList.remove(e);e.split(/\s+/).forEach(e=>t.classList.remove(e))}return t}},V=t=>{const e=`matrix(${t.join()})`;return{transform:e,webkitTranform:e,mozTransform:e,msTransform:e,otransform:e}},A=D("svg").createSVGPoint(),z=/[+-]?\d+(\.\d+)?/g,C=["circle","ellipse","image","line","path","polygon","polyline","rect","text","g","foreignobject"];function D(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}const X=t=>{const e=[];return L(t)?s.call(t.childNodes,t=>{if(1===t.nodeType){const s=t.tagName.toLowerCase();-1!==C.indexOf(s)&&("g"===s&&e.push(...X(t)),e.push(t))}}):e.push(t),e},Y=()=>D("svg").createSVGMatrix(),N=(t,e)=>(e.getScreenCTM()||Y()).inverse().multiply(t.getScreenCTM()||Y()),R=t=>{const{a:e,b:s,c:o,d:r,e:n,f:a}=t;return`matrix(${e},${s},${o},${r},${n},${a})`},O=(t,e,s)=>(A.x=e,A.y=s,A.matrixTransform(t)),P=t=>{const e=Y();return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f,e},B=(t,e,s)=>{if(c(e)||c(s))return null;const o=t.createSVGPoint();return o.x=e,o.y=s,o},L=t=>"g"===t.tagName.toLowerCase(),F=t=>t.match(z).reduce((t,e,s,o)=>(s%2==0&&t.push(o.slice(s,s+2)),t),[]);class H extends b{constructor(t,e,s){if(super(t),this.constructor===H)throw new TypeError("Cannot construct Transformable instances directly");this.observable=s,g.forEach(t=>{this.eventDispatcher.registerEvent(t)}),this.enable(e)}_cursorPoint(){throw Error("'_cursorPoint()' method not implemented")}_rotate({radians:t,...e}){const s={transform:this._processRotate(t),delta:t,...e};this.proxyMethods.onRotate.call(this,s),this._emitEvent("rotate",s)}_resize({dx:t,dy:e,...s}){const o={...this._processResize(t,e),dx:t,dy:e,...s};this.proxyMethods.onResize.call(this,o),this._emitEvent("resize",o)}_processOptions(t){const{el:e}=this;S(e,"sjx-drag");const s={x:10,y:10,angle:10*v},o={move:!1,resize:!1,rotate:!1};let r=null,n=!1,a=!1,l="xy",u=!1,d=5,x=!0,f=!1,y=!1,b=!1,m="auto",g="auto",_="auto",M=!1,w=!0,E=!0,j=!0,k=null,T=50,V=!0,A=null,z=()=>{},C=()=>{},D=()=>{},X=()=>{},Y=()=>{},N=()=>{},R=e.parentNode;if(i(t)){const{snap:S,each:O,axis:P,cursorMove:B,cursorResize:L,cursorRotate:F,rotationPoint:H,restrict:W,draggable:$,resizable:q,rotatable:I,onInit:G,onDrop:U,onMove:Q,onResize:Z,onRotate:J,onDestroy:K,container:tt,proportions:et,keepTransformations:st,custom:ot,rotatorAnchor:rt,rotatorOffset:nt,showNormal:at,withoutScaling:it,minSize:ct,allowReversing:lt,minStartDistance:ht,processMove:ut,processResize:dt}=t;if(i(S)){const{x:t,y:e,angle:o}=S;s.x=c(t)?10:t,s.y=c(e)?10:e,s.angle=c(o)?s.angle:o*v}if(i(O)){const{move:t,resize:e,rotate:s}=O;o.move=t||!1,o.resize=e||!1,o.rotate=s||!1}i(W)&&(r="parent"===W?e.parentNode:p(W)[0]||document),m=B||"auto",g=L||"auto",_=F||"auto",l=P||"xy",R=i(tt)&&p(tt)[0]?p(tt)[0]:R,M=H||!1,n=et||!1,a="boolean"==typeof st?st:["g","svg","rect","foreignobject"].includes(e.tagName.toLowerCase()),u=it||!1,d=ct||5,x=lt||!0,b=ht||!1,f=ut||!1,y=dt||!1,w=!i($)||$,E=!i(q)||q,j=!i(I)||I,A="object"==typeof ot&&ot||null,k=rt||null,T=nt||50,V=!i(at)||at,z=h(G),Y=h(U),C=h(Q),X=h(Z),D=h(J),N=h(K)}this.options={axis:l,cursorMove:m,cursorRotate:_,cursorResize:g,rotationPoint:M,restrict:r,container:R,snap:s,each:o,proportions:n,keepTransformations:a,draggable:w,resizable:E,rotatable:j,custom:A,rotatorAnchor:k,rotatorOffset:T,showNormal:V,withoutScaling:u,minSize:d,allowReversing:x,minStartDistance:b,processMove:f,processResize:y},this.proxyMethods={onInit:z,onDrop:Y,onMove:C,onResize:X,onRotate:D,onDestroy:N},this.subscribe(o)}_animate(){const e=this,{observable:s,storage:o,options:r}=e;if(c(o))return;if(o.frame=t(e._animate),!o.doDraw)return;o.doDraw=!1;let{dox:n,doy:a,clientX:l,clientY:h,doDrag:u,doResize:d,doRotate:p,doSetCenter:x,revX:f,revY:y}=o;const{snap:b,each:{move:m,resize:g,rotate:v},restrict:M,draggable:w,resizable:E,rotatable:j}=r;if(d&&E){const{transform:t,cx:r,cy:i}=o,{x:c,y:u}=this._pointToElement({x:l,y:h});let d=n?_(c-r,b.x/t.scX):0,p=a?_(u-i,b.y/t.scY):0;d=n?f?-d:d:0,p=a?y?-p:p:0;const x={dx:d,dy:p,clientX:l,clientY:h};e._resize(x),g&&s.notify("onresize",e,x)}if(u&&w){const{restrictOffset:t,elementOffset:r,nx:c,ny:u}=o;if(i(M)){const{left:e,top:s}=t,{left:o,top:n,width:a,height:i}=r,d=c-l,p=u-h,x=M.clientWidth-a,f=M.clientHeight-i,y=n-s,b=o-e;y-p<0&&(h=u-n+s),b-d<0&&(l=c-o+e),y-p>f&&(h=f+(u-n+s)),b-d>x&&(l=x+(c-o+e))}const d={dx:n?_(l-c,b.x):0,dy:a?_(h-u,b.y):0,clientX:l,clientY:h};e._drag(d),m&&s.notify("onmove",e,d)}if(p&&j){const{pressang:t,center:r}=o,n=Math.atan2(h-r.y,l-r.x)-t,a={clientX:l,clientY:h};e._rotate({radians:_(n,b.angle),...a}),v&&s.notify("onrotate",e,{radians:n,...a})}if(x&&j){const{bx:t,by:s}=o,{x:r,y:n}=this._pointToControls({x:l,y:h});e._moveCenterHandle(r-t,n-s)}}_start(t){const{observable:e,storage:s,options:{axis:o,restrict:r,each:n},el:a}=this,c=this._compute(t);Object.keys(c).forEach(t=>{s[t]=c[t]});const{onRightEdge:l,onBottomEdge:h,onTopEdge:u,onLeftEdge:d,handle:p,factor:x,revX:f,revY:y,doW:b,doH:m}=c,g=l||h||u||d,{handles:v}=s,{rotator:_,center:M,radius:w}=v;i(w)&&T(w,"sjx-hidden");const j=p.is(_)||_&&p.is(_.firstElementChild),k=!!i(M)&&p.is(M),S=!(j||g||k),{clientX:V,clientY:A}=t,{x:z,y:C}=this._cursorPoint({clientX:V,clientY:A}),{x:D,y:X}=this._pointToElement({x:z,y:C}),{x:Y,y:N}=this._pointToControls({x:z,y:C}),R={clientX:V,clientY:A,nx:z,ny:C,cx:D,cy:X,bx:Y,by:N,doResize:g,doDrag:S,doRotate:j,doSetCenter:k,onExecution:!0,cursor:null,elementOffset:E(a),restrictOffset:i(r)?E(r):null,dox:/\x/.test(o)&&(!g||(p.is(v.ml)||p.is(v.mr)||p.is(v.tl)||p.is(v.tr)||p.is(v.bl)||p.is(v.br))),doy:/\y/.test(o)&&(!g||(p.is(v.br)||p.is(v.bl)||p.is(v.bc)||p.is(v.tr)||p.is(v.tl)||p.is(v.tc)))};this.storage={...s,...R};const O={clientX:V,clientY:A};g?this._emitEvent("resizeStart",O):j?this._emitEvent("rotateStart",O):S&&this._emitEvent("dragStart",O);const{move:P,resize:B,rotate:L}=n,F=g?"resize":j?"rotate":"drag",H=g&&B||j&&L||S&&P;e.notify("ongetstate",this,{clientX:V,clientY:A,actionName:F,triggerEvent:H,factor:x,revX:f,revY:y,doW:b,doH:m}),this._draw()}_moving(t){const{storage:e,options:s}=this,{x:o,y:r}=this._cursorPoint(t);e.e=t,e.clientX=o,e.clientY=r,e.doDraw=!0;let{doRotate:n,doDrag:a,doResize:i,cursor:l}=e;const{cursorMove:h,cursorResize:u,cursorRotate:d}=s;c(l)&&(a?l=h:n?l=d:i&&(l=u),p(document.body).css({cursor:l}))}_end({clientX:t,clientY:s}){const{options:{each:o},observable:r,storage:n,proxyMethods:a}=this,{doResize:c,doDrag:l,doRotate:h,frame:u,handles:{radius:d}}=n,x=c?"resize":l?"drag":"rotate";n.doResize=!1,n.doDrag=!1,n.doRotate=!1,n.doSetCenter=!1,n.doDraw=!1,n.onExecution=!1,n.cursor=null,this._apply(x);const f={clientX:t,clientY:s};a.onDrop.call(this,f),c?this._emitEvent("resizeEnd",f):h?this._emitEvent("rotateEnd",f):l&&this._emitEvent("dragEnd",f),n.outOfSnap=!1;const{move:y,resize:b,rotate:m}=o,g=c&&b||h&&m||l&&y;r.notify("onapply",this,{clientX:t,clientY:s,actionName:x,triggerEvent:g}),e(u),p(document.body).css({cursor:"auto"}),i(d)&&S(d,"sjx-hidden")}_compute(t){const{handles:e}=this.storage,s=p(t.target),{revX:o,revY:r,doW:n,doH:a,...i}=this._checkHandles(s,e),c=this._getState({revX:o,revY:r,doW:n,doH:a}),{x:l,y:h}=this._cursorPoint(t),u=Math.atan2(h-c.center.y,l-c.center.x);return{...c,...i,handle:s,pressang:u}}_checkHandles(t,e){const{tl:s,tc:o,tr:r,bl:n,br:a,bc:c,ml:l,mr:h}=e,u=!!i(s)&&t.is(s),d=!!i(o)&&t.is(o),p=!!i(r)&&t.is(r),x=!!i(n)&&t.is(n),f=!!i(c)&&t.is(c),y=!!i(a)&&t.is(a),b=!!i(l)&&t.is(l),m=!!i(h)&&t.is(h);return{revX:u||b||x||d,revY:u||p||d||b,onTopEdge:d||p||u,onLeftEdge:u||b||x,onRightEdge:p||m||y,onBottomEdge:y||f||x,doW:b||m,doH:d||f}}notifyMove(){this._drag(...arguments)}notifyRotate({radians:t,...e}){const{snap:{angle:s}}=this.options;this._rotate({radians:_(t,s),...e})}notifyResize(){this._resize(...arguments)}notifyApply({clientX:t,clientY:e,actionName:s,triggerEvent:o}){this.proxyMethods.onDrop.call(this,{clientX:t,clientY:e}),o&&(this._apply(s),this._emitEvent(s+"End",{clientX:t,clientY:e}))}notifyGetState({clientX:t,clientY:e,actionName:s,triggerEvent:o,...r}){if(o){const o=this._getState(r);this.storage={...this.storage,...o},this._emitEvent(s+"Start",{clientX:t,clientY:e})}}subscribe({resize:t,move:e,rotate:s}){const{observable:o}=this;(e||t||s)&&o.subscribe("ongetstate",this).subscribe("onapply",this),e&&o.subscribe("onmove",this),t&&o.subscribe("onresize",this),s&&o.subscribe("onrotate",this)}unsubscribe(){const{observable:t}=this;t.unsubscribe("ongetstate",this).unsubscribe("onapply",this).unsubscribe("onmove",this).unsubscribe("onresize",this).unsubscribe("onrotate",this)}disable(t,e){const{storage:s,proxyMethods:o,el:r}=this;c(s)||(s.onExecution&&(this._end({clientX:t,clientY:e}),p(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp).off("touchmove",this._onTouchMove).off("touchend",this._onTouchEnd)),T(r,"sjx-drag"),this._destroy(),this.unsubscribe(),o.onDestroy.call(this,r),delete this.storage)}exeDrag({dx:t,dy:e}){const{draggable:s}=this.options;s&&(this.storage={...this.storage,...this._getState({revX:!1,revY:!1,doW:!1,doH:!1})},this._drag({dx:t,dy:e}),this._apply("drag"))}exeResize({dx:t,dy:e,revX:s,revY:o,doW:r,doH:n}){const{resizable:a}=this.options;a&&(this.storage={...this.storage,...this._getState({revX:s||!1,revY:o||!1,doW:r||!1,doH:n||!1})},this._resize({dx:t,dy:e}),this._apply("resize"))}exeRotate({delta:t}){const{rotatable:e}=this.options;e&&(this.storage={...this.storage,...this._getState({revX:!1,revY:!1,doW:!1,doH:!1})},this._rotate({radians:t}),this._apply("rotate"))}}const W=({x:t,y:e},s)=>{const[o,r,n,a,i,c]=s;return{x:o*t+n*e+i,y:r*t+a*e+c}},$=t=>{const e=[[t[0],t[2],t[4]],[t[1],t[3],t[5]],[0,0,1]];if(e.length!==e[0].length)return;const s=e.length,o=[],r=[];for(let t=0;t<s;t+=1){o[o.length]=[],r[r.length]=[];for(let n=0;n<s;n+=1)o[t][n]=t==n?1:0,r[t][n]=e[t][n]}for(let t=0;t<s;t+=1){let e=r[t][t];if(0===e){for(let n=t+1;n<s;n+=1)if(0!==r[n][t]){for(let a=0;a<s;a++)e=r[t][a],r[t][a]=r[n][a],r[n][a]=e,e=o[t][a],o[t][a]=o[n][a],o[n][a]=e;break}if(e=r[t][t],0===e)return}for(let n=0;n<s;n++)r[t][n]=r[t][n]/e,o[t][n]=o[t][n]/e;for(let n=0;n<s;n++)if(n!=t){e=r[n][t];for(let a=0;a<s;a++)r[n][a]-=e*r[t][a],o[n][a]-=e*o[t][a]}}return[o[0][0],o[1][0],o[0][1],o[1][1],o[0][2],o[1][2]]},q=([t,e,s,o,r,n],[a,i,c,l,h,u])=>{const d=[[t,s,r],[e,o,n],[0,0,1]],p=[[a,c,h],[i,l,u],[0,0,1]],x=[];for(let t=0;t<p.length;t++){x[t]=[];for(let e=0;e<d[0].length;e++){let s=0;for(let o=0;o<d.length;o++)s+=d[o][e]*p[t][o];x[t].push(s)}}return[x[0][0],x[1][0],x[0][1],x[1][1],x[0][2],x[1][2]]},I=(t,e,s,o,r,n,a,i,c)=>{const l=parseFloat(s)/2,h=parseFloat(o)/2,u=t+l,d=e+h,p=t-u,x=e-d,f=Math.atan2(i?0:x,c?0:p)+r,y=Math.sqrt(Math.pow(c?0:l,2)+Math.pow(i?0:h,2));let b=Math.cos(f),m=Math.sin(f);b=!0===n?-b:b,m=!0===a?-m:m;const g=d+y*m;return{left:w(u+y*b),top:w(g)}};class G extends H{_init(t){const{rotationPoint:e,container:s,resizable:o,rotatable:r,showNormal:n}=this.options,{left:a,top:l,width:h,height:u}=t.style,d=document.createElement("div");S(d,"sjx-wrapper"),s.appendChild(d);const x=p(t),f=h||x.css("width"),y=u||x.css("height"),b={top:l||x.css("top"),left:a||x.css("left"),width:f,height:y,transform:j(x)},m=document.createElement("div");S(m,"sjx-controls");const g={...r&&{normal:n?["sjx-normal"]:null,rotator:["sjx-hdl","sjx-hdl-m","sjx-rotator"]},...o&&{tl:["sjx-hdl","sjx-hdl-t","sjx-hdl-l","sjx-hdl-tl"],tr:["sjx-hdl","sjx-hdl-t","sjx-hdl-r","sjx-hdl-tr"],br:["sjx-hdl","sjx-hdl-b","sjx-hdl-r","sjx-hdl-br"],bl:["sjx-hdl","sjx-hdl-b","sjx-hdl-l","sjx-hdl-bl"],tc:["sjx-hdl","sjx-hdl-t","sjx-hdl-c","sjx-hdl-tc"],bc:["sjx-hdl","sjx-hdl-b","sjx-hdl-c","sjx-hdl-bc"],ml:["sjx-hdl","sjx-hdl-m","sjx-hdl-l","sjx-hdl-ml"],mr:["sjx-hdl","sjx-hdl-m","sjx-hdl-r","sjx-hdl-mr"]},center:e&&r?["sjx-hdl","sjx-hdl-m","sjx-hdl-c","sjx-hdl-mc"]:void 0};if(Object.keys(g).forEach(t=>{const e=g[t];if(c(e))return;const s=U(e);g[t]=s,m.appendChild(s)}),i(g.center)){p(g.center).css({left:t.getAttribute("data-cx")+"px",top:t.getAttribute("data-cy")+"px"})}d.appendChild(m);const v=p(m);v.css(b),this.storage={controls:m,handles:g,radius:void 0,parent:t.parentNode},v.on("mousedown",this._onMouseDown).on("touchstart",this._onTouchStart)}_destroy(){const{controls:t}=this.storage;p(t).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart);const e=t.parentNode;e.parentNode.removeChild(e)}_pointToElement({x:t,y:e}){const{transform:s}=this.storage,o=[...s.matrix];return o[4]=o[5]=0,this._applyMatrixToPoint($(o),t,e)}_pointToControls(t){return this._pointToElement(t)}_applyMatrixToPoint(t,e,s){return W({x:e,y:s},t)}_cursorPoint({clientX:t,clientY:e}){const{container:s}=this.options,o=k(j(p(s)));return W({x:t,y:e},$(o))}_apply(){const{el:t,storage:e}=this,{controls:s,handles:o}=e,r=p(s),n=parseFloat(r.css("width"))/2,a=parseFloat(r.css("height"))/2,{center:c}=o,l=i(c),h=l?parseFloat(p(c).css("left")):n,u=l?parseFloat(p(c).css("top")):a;t.setAttribute("data-cx",h),t.setAttribute("data-cy",u),this.storage.cached=null}_processResize(t,e){const{el:s,storage:o,options:{proportions:r}}=this,{controls:n,coords:a,cw:i,ch:c,transform:l,refang:h,revX:u,revY:d,doW:x,doH:f}=o,y=x||!x&&!f?(i+t)/i:(c+e)/c,b=r?i*y:i+t,m=r?c*y:c+e;if(b<=2||m<=2)return;const g=[...l.matrix],v=I(g[4],g[5],b,m,h,u,d,x,f),_=a.left-v.left,M=a.top-v.top;g[4]+=_,g[5]+=M;const w=V(g);return w.width=b+"px",w.height=m+"px",p(n).css(w),p(s).css(w),o.cached={dx:_,dy:M},{width:b,height:m,ox:_,oy:M}}_processMove(t,e){const{el:s,storage:o}=this,{controls:r,transform:{matrix:n,parentMatrix:a}}=o,i=[...a];i[4]=i[5]=0;const c=[...n];c[4]=n[4]+t,c[5]=n[5]+e;const l=V(c);return p(r).css(l),p(s).css(l),o.cached={dx:t,dy:e},c}_processRotate(t){const{el:e,storage:{controls:s,transform:o,center:r}}=this,{matrix:n,parentMatrix:a}=o,i=w(Math.cos(t),4),c=w(Math.sin(t),4),l=[1,0,0,1,r.cx,r.cy],h=[i,c,-c,i,0,0],u=[...a];u[4]=u[5]=0;const d=q($(u),q(h,u)),x=q(q(l,d),$(l)),f=q(x,n),y=V(f);return p(s).css(y),p(e).css(y),f}_getState(t){const{revX:e,revY:s,doW:o,doH:r}=t,n=e!==s?-1:1,{el:a,storage:{handles:c,controls:l,parent:h},options:{container:u}}=this,{center:d}=c,x=p(l),f=k(j(p(u))),y=k(j(p(l))),b=k(j(p(h))),m=Math.atan2(y[1],y[0])*n,g=h!==u?q(b,f):f,v={matrix:y,parentMatrix:g,scX:Math.sqrt(y[0]*y[0]+y[1]*y[1]),scY:Math.sqrt(y[2]*y[2]+y[3]*y[3])},_=parseFloat(x.css("width")),M=parseFloat(x.css("height")),w=I(y[4],y[5],_,M,m,e,s,o,r),S=_/2,T=M/2,V=E(a),A=i(d),z=A?parseFloat(p(d).css("left")):S,C=A?parseFloat(p(d).css("top")):T,D=A?7:0,{x:X,y:Y}=W({x:V.left,y:V.top},$(g));return{transform:v,cw:_,ch:M,coords:w,center:{x:X+z-D,y:Y+C-D,cx:-z+S-D,cy:-C+T-D,hx:z,hy:C},factor:n,refang:m,revX:e,revY:s,doW:o,doH:r}}_moveCenterHandle(t,e){const{handles:{center:s},center:{hx:o,hy:r}}=this.storage,n=o+t+"px",a=r+e+"px";p(s).css({left:n,top:a})}resetCenterPoint(){const{handles:{center:t}}=this.storage;p(t).css({left:null,top:null})}fitControlsToSize(){}get controls(){return this.storage.controls}}const U=t=>{const e=document.createElement("div");return t.forEach(t=>{S(e,t)}),e},Q=/\s*([achlmqstvz])([^achlmqstvz]*)\s*/gi,Z=/\s*,\s*|\s+/g,J=t=>{let e=Q.lastIndex=0;const s=[];for(;e=Q.exec(t);){const t=e[1],o=t.toUpperCase(),r=e[2].replace(/([^e])-/g,"$1 -").replace(/ +/g," ");s.push({relative:t!==o,key:o,cmd:t,values:r.trim().split(Z).map(t=>{if(!isNaN(t))return Number(t)})})}return s},K=t=>{const{path:e,dx:s,dy:o}=t;try{const t=J(e);let r="",n=" ",a=!0;for(let e=0,i=t.length;e<i;e++){const i=t[e],{values:c,key:l,relative:h}=i,u=[];switch(l){case"M":for(let t=0,e=c.length;t<e;t+=2){let[e,r]=c.slice(t,t+2);h&&!a||(e+=s,r+=o),u.push(e,r),a=!1}break;case"A":for(let t=0,e=c.length;t<e;t+=7){const e=c.slice(t,t+7);h||(e[5]+=s,e[6]+=o),u.push(...e)}break;case"C":for(let t=0,e=c.length;t<e;t+=6){const e=c.slice(t,t+6);h||(e[0]+=s,e[1]+=o,e[2]+=s,e[3]+=o,e[4]+=s,e[5]+=o),u.push(...e)}break;case"H":for(let t=0,e=c.length;t<e;t+=1){const e=c.slice(t,t+1);h||(e[0]+=s),u.push(e[0])}break;case"V":for(let t=0,e=c.length;t<e;t+=1){const e=c.slice(t,t+1);h||(e[0]+=o),u.push(e[0])}break;case"L":case"T":for(let t=0,e=c.length;t<e;t+=2){let[e,r]=c.slice(t,t+2);h||(e+=s,r+=o),u.push(e,r)}break;case"Q":case"S":for(let t=0,e=c.length;t<e;t+=4){let[e,r,n,a]=c.slice(t,t+4);h||(e+=s,r+=o,n+=s,a+=o),u.push(e,r,n,a)}break;case"Z":c[0]="",n=""}r+=i.cmd+u.join(",")+n}return r}catch(t){a("Path parsing error: "+t)}},tt=t=>{const{path:e,localCTM:s}=t;try{const t=J(e);let o="",r=" ";const n=[];let a=!0;for(let e=0,i=t.length;e<i;e++){const i=t[e],{values:c,key:l,relative:h}=i;switch(l){case"A":{const t=[];for(let e=0,o=c.length;e<o;e+=7){const[o,r,n,a,i,l,u]=c.slice(e,e+7),d=P(s);h&&(d.e=d.f=0);const{x:p,y:x}=O(d,l,u);t.push(w(p),w(x)),d.e=d.f=0;const{x:f,y:y}=O(d,o,r);t.unshift(w(f),w(y),n,a,i)}n.push(t);break}case"C":{const t=[];for(let e=0,o=c.length;e<o;e+=6){const[o,r,n,a,i,l]=c.slice(e,e+6),u=P(s);h&&(u.e=u.f=0);const{x:d,y:p}=O(u,o,r),{x:x,y:f}=O(u,n,a),{x:y,y:b}=O(u,i,l);t.push(w(d),w(p),w(x),w(f),w(y),w(b))}n.push(t);break}case"H":{const t=[];for(let e=0,o=c.length;e<o;e+=1){const[o]=c.slice(e,e+1),r=P(s);h&&(r.e=r.f=0);const{x:n}=O(r,o,0);t.push(w(n))}n.push(t);break}case"V":{const t=[];for(let e=0,o=c.length;e<o;e+=1){const[o]=c.slice(e,e+1),r=P(s);h&&(r.e=r.f=0);const{y:n}=O(r,0,o);t.push(w(n))}n.push(t);break}case"T":case"L":{const t=[];for(let e=0,o=c.length;e<o;e+=2){const[o,r]=c.slice(e,e+2),n=P(s);h&&(n.e=n.f=0);const{x:a,y:i}=O(n,o,r);t.push(w(a),w(i))}n.push(t);break}case"M":{const t=[];for(let e=0,o=c.length;e<o;e+=2){const[o,r]=c.slice(e,e+2),n=P(s);h&&!a&&(n.e=n.f=0);const{x:i,y:l}=O(n,o,r);t.push(w(i),w(l)),a=!1}n.push(t);break}case"Q":{const t=[];for(let e=0,o=c.length;e<o;e+=4){const[o,r,n,a]=c.slice(e,e+4),i=P(s);h&&(i.e=i.f=0);const{x:l,y:u}=O(i,o,r),{x:d,y:p}=O(i,n,a);t.push(w(l),w(u),w(d),w(p))}n.push(t);break}case"S":{const t=[];for(let e=0,o=c.length;e<o;e+=4){const[o,r,n,a]=c.slice(e,e+4),i=P(s);h&&(i.e=i.f=0);const{x:l,y:u}=O(i,o,r),{x:d,y:p}=O(i,n,a);t.push(w(l),w(u),w(d),w(p))}n.push(t);break}case"Z":n.push([""]),r=""}o+=i.cmd+n[e].join(",")+r}return o}catch(t){a("Path parsing error: "+t)}};class et extends H{_init(t){const{rotationPoint:e,container:s,resizable:o,rotatable:r,rotatorAnchor:n,rotatorOffset:a,showNormal:h,custom:u}=this.options,d=D("g");S(d,"sjx-svg-wrapper"),S(d,t.nodeName),s.appendChild(d);const{width:x,height:f,x:y,y:b}=t.getBBox(),m=N(t,s),g=D("rect");[["width",x],["height",f],["x",y],["y",b],["fill","#00a8ff"],["fill-opacity",0],["stroke","#00a8ff"],["stroke-dasharray","3 3"],["vector-effect","non-scaling-stroke"],["transform",R(m)]].forEach(([t,e])=>{g.setAttribute(t,e)});const v=D("g"),_=D("g"),M=D("g");S(M,"sjx-svg-box-group"),S(v,"sjx-svg-handles"),S(_,"sjx-svg-normal-group"),M.appendChild(g),d.appendChild(M),d.appendChild(_),d.appendChild(v);const w=g.getBBox(),{x:E,y:j,width:k,height:T}=w,V=t.getAttribute("data-cx"),A=t.getAttribute("data-cy"),z=N(g,g.parentNode),C=O(z,E+k/2,j+T/2),X=O(z,E,j),Y=O(z,E+k,j),P=O(z,E+k,j+T/2),L=O(z,E,j+T/2),F=O(z,E+k/2,j),H=O(z,E+k/2,j+T),W=O(z,E+k,j+T),$=O(z,E,j+T),q={tl:X,tr:Y,br:W,bl:$,tc:F,bc:H,ml:L,mr:P};let I={},G=null;if(r){const t={};let s=1;switch(n){case"n":t.x=F.x,t.y=F.y;break;case"s":t.x=H.x,t.y=H.y,s=-1;break;case"w":t.x=L.x,t.y=L.y,s=-1;break;case"e":default:t.x=P.x,t.y=P.y}const o="n"===n||"s"===n?Math.atan2($.y-X.y,$.x-X.x):Math.atan2(X.y-Y.y,X.x-Y.x);G={x:t.x-a*s*Math.cos(o),y:t.y-a*s*Math.sin(o)};const r=h?D("line"):null;h&&(r.x1.baseVal.value=t.x,r.y1.baseVal.value=t.y,r.x2.baseVal.value=G.x,r.y2.baseVal.value=G.y,at(r,"#00a8ff"),_.appendChild(r));let i=null;e&&(i=D("line"),S(i,"sjx-hidden"),i.x1.baseVal.value=C.x,i.y1.baseVal.value=C.y,i.x2.baseVal.value=V||C.x,i.y2.baseVal.value=A||C.y,at(i,"#fe3232"),i.setAttribute("opacity",.5),_.appendChild(i)),I={normal:r,radius:i}}const U={...o&&q,rotator:G,center:e&&r?B(s,V,A)||C:void 0};Object.keys(U).forEach(t=>{const e=U[t];if(c(e))return;const{x:s,y:o}=e,r="center"===t?"#fe3232":"#00a8ff";i(u)&&l(u[t])?U[t]=u[t](z,w,O):U[t]=nt(s,o,r,t),v.appendChild(U[t])}),this.storage={wrapper:d,box:g,handles:{...U,...I},parent:t.parentNode},p(d).on("mousedown",this._onMouseDown).on("touchstart",this._onTouchStart)}fitTo(t,e){const{options:s,storage:o}=this,{box:r}=o;if(e){const e=parseFloat(r.getAttribute("height"));parseFloat(t.getAttribute("height"))<e&&t.setAttribute("height",e)}r.setAttribute("height",t.getAttribute("height"));const{x:n,y:a}=r.getBBox();rt(o,s,{x:n,y:a,width:parseFloat(r.getAttribute("width")),height:parseFloat(r.getAttribute("height")),boxMatrix:null})}_destroy(){const{wrapper:t}=this.storage;p(t).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart),t.parentNode.removeChild(t)}_cursorPoint(t){const{container:e}=this.options,s=e.getBoundingClientRect(),o=e.getScreenCTM();return o.e=s.x,o.f=s.y,O(o.inverse(),t.clientX,t.clientY)}_pointToElement({x:t,y:e}){const{transform:s}=this.storage,{ctm:o}=s,r=o.inverse();return r.e=r.f=0,this._applyMatrixToPoint(r,t,e)}_pointToControls({x:t,y:e}){const{transform:s}=this.storage,{boxCTM:o}=s,r=o.inverse();return r.e=r.f=0,this._applyMatrixToPoint(r,t,e)}_applyMatrixToPoint(t,e,s){const{container:o}=this.options,r=o.createSVGPoint();return r.x=e,r.y=s,r.matrixTransform(t)}_apply(t){const{el:e,storage:s,options:o,options:{container:r}}=this,{box:n,handles:a,cached:l,transform:h}=s,{matrix:u,boxCTM:d,bBox:p,ctm:x}=h,f=e.getBBox(),{x:y,y:b,width:m,height:g}=f,v=i(a.center)?O(d,a.center.cx.baseVal.value,a.center.cy.baseVal.value):O(u,y+m/2,b+g/2);if(e.setAttribute("data-cx",v.x),e.setAttribute("data-cy",v.y),c(l))return;const{scaleX:_,scaleY:M,dx:w,dy:E}=l;if("drag"===t){if(0===w&&0===E)return;const t=Y();t.e=w,t.f=E;const s=t.multiply(u).multiply(t.inverse());o.keepTransformations||(e.setAttribute("transform",R(s)),st(e,{x:w,y:E}))}if("resize"===t){const{x:t,y:a,width:i,height:c}=n.getBBox();o.keepTransformations?this.storage.temporalCtm=x:(rt(s,o,{x:t,y:a,width:i,height:c,boxMatrix:null}),ot(e,{scaleX:_,scaleY:M,defaultCTM:x,bBox:p,container:r,storage:s,withoutScaling:o.withoutScaling}),e.setAttribute("transform",R(u)))}this.storage.cached=null}_processResize(t,e){const{el:s,storage:o,options:r,options:{proportions:n,processResize:a,withoutScaling:i,minSize:c,allowReversing:l}}=this,{left:h,top:u,cw:d,ch:p,transform:x,revX:f,revY:y,doW:b,doH:m}=o,{matrix:g,scMatrix:v,trMatrix:_,scaleX:M,scaleY:w}=x;let{width:E,height:j}=s.getBBox();s.dataset.temporalWidth&&(E=s.dataset.temporalWidth,j=s.dataset.temporalHeight);const k={};if(a){const s=a(t,e,f,y);k.fdx=t+(s&&s.x?s.x:0),k.fdy=e+(s&&s.y?s.y:0),t+=s&&s.x?s.x:0,e+=s&&s.y?s.y:0}let S=b||!b&&!m?(d+t)/d:(p+e)/p;E=n?d*S:d+t,j=n?p*S:p+e;let T={};if("number"==typeof c&&(T.x=c,T.y=c),"object"==typeof c&&Object.prototype.hasOwnProperty.call(c,"x")&&Object.prototype.hasOwnProperty.call(c,"y")&&(T=c),Math.abs(E)<=T.x||Math.abs(j)<=T.y)return;if((i||l)&&E<=0)return;if((i||l)&&j<=0)return;const V=E/d,A=j/p;if(v.a=V,v.b=0,v.c=0,v.d=A,v.e=0,v.f=0,_.e=M,_.f=w,i){const s=t<0?Math.abs(t):-Math.abs(t),o=e<0?Math.abs(e):-Math.abs(e);v.a=1,v.b=0,v.c=0,v.d=1,v.e=f?s:0,v.f=y?o:0}const z=_.multiply(v).multiply(_.inverse()),C=g.multiply(z);s.setAttribute("transform",R(C)),i&&(s.setAttribute("width",E),s.setAttribute("height",j));const D=h-(E-d)*(m?.5:f?1:0),X=u-(j-p)*(b?.5:y?1:0);this.storage.cached={scaleX:V,scaleY:A};const Y={x:D,y:X,width:E,height:j,...k};return rt(o,r,{...Y,boxMatrix:null}),Y}_processMove(t,e){const{transform:s,wrapper:o,center:r}=this.storage,{options:{processMove:n,minStartDistance:a}}=this,{matrix:i,trMatrix:c,scMatrix:l,wrapperMatrix:h,parentMatrix:u}=s;!this.storage.outOfSnap&&a&&Math.abs(t)<a&&Math.abs(e)<a?(t=0,e=0):this.storage.outOfSnap=!0,l.e=t,l.f=e;const d=l.multiply(h);o.setAttribute("transform",R(d)),u.e=u.f=0;const{x:p,y:x}=O(u.inverse(),t,e);c.e=p,c.f=x;let f=n&&n(p,x);const y={fdx:t,fdy:e};if(f){const s=function(t,e,s,o,r){let n=Math.cos,a=Math.sin;return{x:(t-s)*n(r=r*Math.PI/180)-(e-o)*a(r)+s,y:(t-s)*a(r)+(e-o)*n(r)+o}}(f.x||0,f.y||0,0,0,f.rotation||0);d.e+=s.x,d.f+=s.y,o.setAttribute("transform",R(d)),c.e+=f.x/u.a||0,c.f+=f.y/u.d||0,y.fdx=t+f.x,y.fdy=e+f.y,(t<0&&t>y.fdx||t>0&&t<y.fdx)&&(y.fdx=t),(e<0&&e>y.fdy||e>0&&e<y.fdy)&&(y.fdy=e)}const b=c.multiply(i);if(this.el.setAttribute("transform",R(b)),this.storage.cached={dx:p,dy:x,ox:t,oy:e},r.isShifted){const s=h.inverse();s.e=s.f=0;const{x:o,y:r}=O(s,t,e);this._moveCenterHandle(-o,-r)}return{transform:b,fixedDeltas:y}}_processRotate(t){const{center:e,transform:s,wrapper:o}=this.storage,{matrix:r,wrapperMatrix:n,parentMatrix:a,trMatrix:i,scMatrix:c,rotMatrix:l}=s,h=w(Math.cos(t)),u=w(Math.sin(t));i.e=e.x,i.f=e.y,l.a=h,l.b=u,l.c=-u,l.d=h;const d=i.multiply(l).multiply(i.inverse()).multiply(n);o.setAttribute("transform",R(d)),c.e=e.el_x,c.f=e.el_y,a.e=a.f=0;const p=a.inverse().multiply(l).multiply(a),x=c.multiply(p).multiply(c.inverse()).multiply(r);return this.el.setAttribute("transform",R(x)),x}_getState({revX:t,revY:e,doW:s,doH:o}){const{el:r,storage:n,options:{container:a}}=this,{box:c,wrapper:l,parent:h,handles:{center:u}}=n,d=r.getBBox(),{x:p,y:x,width:f,height:y}=d,{width:b,height:m,x:g,y:v}=c.getBBox(),_=N(r,h),M=n.temporalCtm||N(r,a),E=N(c.parentNode,a),j=N(h,a),k=p+f*(o?.5:t?1:0),S=x+y*(s?.5:e?1:0),T={matrix:_,ctm:M,boxCTM:E,parentMatrix:j,wrapperMatrix:N(l,l.parentNode),trMatrix:Y(),scMatrix:Y(),rotMatrix:Y(),scaleX:k,scaleY:S,scX:Math.sqrt(M.a*M.a+M.b*M.b),scY:Math.sqrt(M.c*M.c+M.d*M.d),bBox:d},V=g+b/2,A=v+m/2,z=u?u.cx.baseVal.value:V,C=u?u.cy.baseVal.value:A,{x:D,y:R}=O(E,z,C),{x:P,y:B}=i(u)?O(j.inverse(),D,R):O(_,p+f/2,x+y/2),{x:L,y:F}=O(N(c,a),V,A);return X(r).forEach(t=>{t.__ctm__=N(t,a)}),{transform:T,cw:b,ch:m,center:{x:u?D:L,y:u?R:F,el_x:P,el_y:B,hx:u?u.cx.baseVal.value:null,hy:u?u.cy.baseVal.value:null,isShifted:w(L,3)!==w(D,3)&&w(F,3)!==w(R,3)},left:g,top:v,revX:t,revY:e,doW:s,doH:o}}_moveCenterHandle(t,e){const{handles:{center:s,radius:o},center:{hx:r,hy:n}}=this.storage;if(c(s))return;const a=r+t,i=n+e;s.cx.baseVal.value=a,s.cy.baseVal.value=i,o.x2.baseVal.value=a,o.y2.baseVal.value=i}resetCenterPoint(){const{box:t,handles:{center:e,radius:s}}=this.storage,{width:o,height:r,x:n,y:a}=t.getBBox(),i=N(t,t.parentNode),{x:c,y:l}=O(i,n+o/2,a+r/2);e.cx.baseVal.value=c,e.cy.baseVal.value=l,e.isShifted=!1,s.x2.baseVal.value=c,s.y2.baseVal.value=l}fitControlsToSize(){const{el:t,storage:{box:e,wrapper:s},options:{container:o}}=this,{width:r,height:n,x:a,y:i}=t.getBBox();this.storage.ch=n;const c=N(t,o);s.removeAttribute("transform"),e.setAttribute("transform",R(c)),rt(this.storage,this.options,{x:a,y:i,width:r,height:n,boxMatrix:c})}get controls(){return this.storage.wrapper}}const st=(t,{x:e,y:s})=>{const o=[];switch(t.tagName.toLowerCase()){case"text":{const r=i(t.x.baseVal[0])?t.x.baseVal[0].value+e:(Number(t.getAttribute("x"))||0)+e,n=i(t.y.baseVal[0])?t.y.baseVal[0].value+s:(Number(t.getAttribute("y"))||0)+s;o.push(["x",r],["y",n]);break}case"use":case"image":case"rect":{const r=i(t.x.baseVal.value)?t.x.baseVal.value+e:(Number(t.getAttribute("x"))||0)+e,n=i(t.y.baseVal.value)?t.y.baseVal.value+s:(Number(t.getAttribute("y"))||0)+s;o.push(["x",r],["y",n]);break}case"circle":case"ellipse":{const r=t.cx.baseVal.value+e,n=t.cy.baseVal.value+s;o.push(["cx",r],["cy",n]);break}case"line":{const r=t.x1.baseVal.value+e,n=t.y1.baseVal.value+s,a=t.x2.baseVal.value+e,i=t.y2.baseVal.value+s;o.push(["x1",r],["y1",n],["x2",a],["y2",i]);break}case"polygon":case"polyline":{const r=F(t.getAttribute("points")).map(t=>(t[0]=Number(t[0])+e,t[1]=Number(t[1])+s,t.join(" "))).join(" ");o.push(["points",r]);break}case"path":{const r=t.getAttribute("d");o.push(["d",K({path:r,dx:e,dy:s})]);break}}o.forEach(e=>{t.setAttribute(e[0],e[1])})},ot=(t,e)=>{const{scaleX:s,scaleY:o,bBox:r,defaultCTM:n,container:a,withoutScaling:c}=e,{width:l,height:h}=r,u=[],d=N(t,a),p=n.inverse().multiply(d);switch(t.tagName.toLowerCase()){case"text":{const e=i(t.x.baseVal[0])?t.x.baseVal[0].value:Number(t.getAttribute("x"))||0,r=i(t.y.baseVal[0])?t.y.baseVal[0].value:Number(t.getAttribute("y"))||0,{x:n,y:a}=O(p,e,r);u.push(["x",n+(s<0?l:0)],["y",a+(o<0?h:0)]);break}case"circle":{const e=t.r.baseVal.value,r=t.cx.baseVal.value,n=t.cy.baseVal.value,a=e*(Math.abs(s)+Math.abs(o))/2,{x:i,y:c}=O(p,r,n);u.push(["r",a],["cx",i],["cy",c]);break}case"image":case"foreignobject":case"rect":{const e=t.width.baseVal.value,r=t.height.baseVal.value,n=t.x.baseVal.value,a=t.y.baseVal.value,{x:i,y:l}=O(p,n,a),h=Math.abs(e*s),d=Math.abs(r*o);u.push(["x",i-(s<0?h:0)],["y",l-(o<0?d:0)]),c||(t.dataset.scale=s,u.push(["width",h],["height",d]));break}case"ellipse":{const e=t.rx.baseVal.value,r=t.ry.baseVal.value,n=t.cx.baseVal.value,a=t.cy.baseVal.value,{x:i,y:c}=O(p,n,a),l=Y();l.a=s,l.d=o;const{x:h,y:d}=O(l,e,r);u.push(["rx",Math.abs(h)],["ry",Math.abs(d)],["cx",i],["cy",c]);break}case"line":{const e=t.x1.baseVal.value,s=t.y1.baseVal.value,o=t.x2.baseVal.value,r=t.y2.baseVal.value,{x:n,y:a}=O(p,e,s),{x:i,y:c}=O(p,o,r);u.push(["x1",n],["y1",a],["x2",i],["y2",c]);break}case"polygon":case"polyline":{const e=F(t.getAttribute("points")).map(t=>{const{x:e,y:s}=O(p,Number(t[0]),Number(t[1]));return t[0]=e,t[1]=s,t.join(" ")}).join(" ");u.push(["points",e]);break}case"path":{const e=t.getAttribute("d");u.push(["d",tt({path:e,localCTM:p})]);break}}u.forEach(([e,s])=>{t.setAttribute(e,s)})},rt=(t,e,s)=>{const{rotatable:o,rotatorAnchor:r,rotatorOffset:n}=e,{box:a,handles:l,center:h}=t;let{x:u,y:d,width:p,height:x,boxMatrix:f}=s;const y=p/2,b=x/2,m=null!==f?f:N(a,a.parentNode),g=O(m,u+y,d+b),v={tl:O(m,u,d),tr:O(m,u+p,d),br:O(m,u+p,d+x),bl:O(m,u,d+x),tc:O(m,u+y,d),bc:O(m,u+y,d+x),ml:O(m,u,d+b),mr:O(m,u+p,d+b),center:i(l.center)&&!h.isShifted?g:void 0};if(o){const t={};let e=1;switch(r){case"n":t.x=v.tc.x,t.y=v.tc.y;break;case"s":t.x=v.bc.x,t.y=v.bc.y,e=-1;break;case"w":t.x=v.ml.x,t.y=v.ml.y,e=-1;break;case"e":default:t.x=v.mr.x,t.y=v.mr.y}const s="n"===r||"s"===r?Math.atan2(v.bl.y-v.tl.y,v.bl.x-v.tl.x):Math.atan2(v.tl.y-v.tr.y,v.tl.x-v.tr.x),o={x:t.x-n*e*Math.cos(s),y:t.y-n*e*Math.sin(s)},{normal:a,radius:c}=l;i(a)&&(a.x1.baseVal.value=t.x,a.y1.baseVal.value=t.y,a.x2.baseVal.value=o.x,a.y2.baseVal.value=o.y),i(c)&&(c.x1.baseVal.value=g.x,c.y1.baseVal.value=g.y,h.isShifted||(c.x2.baseVal.value=g.x,c.y2.baseVal.value=g.y)),v.rotator=o}u+=p<0?p:0,d+=x<0?x:0;const _={x:u,y:d,width:Math.abs(p),height:Math.abs(x)};Object.keys(_).forEach(t=>{a.setAttribute(t,_[t])}),Object.keys(v).forEach(t=>{const e=l[t],s=v[t];c(s)||c(e)||("g"===e.tagName||"path"===e.tagName?e.instance&&"path"===e.tagName?e.instance.transform({x:s.x,y:s.y}):e.setAttribute("transform",`matrix(1, 0, 0, 1, ${s.x}, ${s.y})`):(e.setAttribute("cx",s.x),e.setAttribute("cy",s.y)))})},nt=(t,e,s,o)=>{const r=D("circle");S(r,"sjx-svg-hdl-"+o);const n={cx:t,cy:e,r:5.5,fill:s,stroke:"#fff","fill-opacity":1,"vector-effect":"non-scaling-stroke","stroke-width":1};return Object.keys(n).map(t=>{r.setAttribute(t,n[t])}),r},at=(t,e)=>{t.setAttribute("stroke",e),t.setAttribute("stroke-dasharray","3 3"),t.setAttribute("vector-effect","non-scaling-stroke")};function it(t,e){if(this.length){const s=i(e)&&e instanceof x?e:new x;return n.call(this,(e,o)=>(o instanceof SVGElement?(t=>{const e=t.tagName.toLowerCase();return-1!==C.indexOf(e)||(a("Selected element "+e+" is not allowed to transform. Allowed elements:\ncircle, ellipse, image, line, path, polygon, polyline, rect, text, g, foreignObject"),!1)})(o)&&e.push(new et(o,t,s)):e.push(new G(o,t,s)),e),[])}}class ct extends b{constructor(t,e){super(t),this.enable(e)}_init(){const{el:t,options:e}=this,s=p(t),{style:o,appendTo:r}=e,n={position:"absolute","z-index":"2147483647",...o};this.storage={css:n,parent:i(r)?p(r)[0]:document.body},s.on("mousedown",this._onMouseDown).on("touchstart",this._onTouchStart),g.slice(0,3).forEach(t=>{this.eventDispatcher.registerEvent(t)})}_processOptions(t){let e={},s=null,o=document,r=()=>{},n=()=>{},a=()=>{},c=()=>{};if(i(t)){const{style:o,appendTo:u,stack:d,onInit:x,onMove:f,onDrop:y,onDestroy:b}=t;e=i(o)&&"object"==typeof o?o:e,s=u||null;const m=i(d)?p(d)[0]:document;r=h(x),n=h(f),a=l(y)?function(t){const{clone:e}=this.storage;((t,e)=>{const{top:s,left:o}=E(t),{top:r,left:n}=E(e),a=p(t),i=p(e);return!(s<r||s+parseFloat(a.css("height"))>r+parseFloat(i.css("height"))||o<n||o+parseFloat(a.css("width"))>n+parseFloat(i.css("width")))})(e,m)&&y.call(this,t,this.el,e)}:()=>{},c=h(b)}this.options={style:e,appendTo:s,stack:o},this.proxyMethods={onInit:r,onDrop:a,onMove:n,onDestroy:c}}_start({clientX:t,clientY:e}){const{storage:s,el:o}=this,{parent:r,css:n}=s,{left:a,top:i}=E(r);n.left=t-a+"px",n.top=e-i+"px";const c=o.cloneNode(!0);p(c).css(n),s.clientX=t,s.clientY=e,s.cx=t,s.cy=e,s.clone=c,p(r)[0].appendChild(c),this._draw()}_moving({clientX:t,clientY:e}){const{storage:s}=this;s.clientX=t,s.clientY=e,s.doDraw=!0,s.doMove=!0}_end(t){const{storage:s}=this,{clone:o,frameId:r}=s;s.doDraw=!1,e(r),c(o)||(this.proxyMethods.onDrop.call(this,t),o.parentNode.removeChild(o),delete s.clone)}_animate(){const{storage:e}=this;e.frameId=t(this._animate);const{doDraw:s,clientX:o,clientY:r,cx:n,cy:a}=e;s&&(e.doDraw=!1,this._drag({dx:o-n,dy:r-a}))}_processMove(t,e){const{clone:s}=this.storage,o=`translate(${t}px, ${e}px)`;p(s).css({transform:o,webkitTranform:o,mozTransform:o,msTransform:o,otransform:o})}_destroy(){const{storage:t,proxyMethods:e,el:s}=this;c(t)||(p(s).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart),e.onDestroy.call(this,s),delete this.storage)}disable(){this._destroy()}}function lt(t){if(this.length)return r.call(this,e=>new ct(e,t))}class ht extends u{drag(){return it.call(this,...arguments)}clone(){return lt.call(this,...arguments)}}function ut(t){return new ht(t)}Object.defineProperty(ut,"createObservable",{value:()=>new x}),Object.defineProperty(ut,"Subjx",{value:ht}),Object.defineProperty(ut,"Observable",{value:x}),module.exports=ut;
