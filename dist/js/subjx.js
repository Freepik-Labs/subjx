/*@license
* Drag/Rotate/Resize Library
* Released under the MIT license, 2018-2020
* Karen Sarksyan
* nichollascarter@gmail.com
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).subjx=e()}(this,function(){"use strict";function pt(t){return(pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function at(a){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?e(Object(o),!0).forEach(function(t){var e,r,n;e=a,n=o[r=t],r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach(function(t){Object.defineProperty(a,t,Object.getOwnPropertyDescriptor(o,t))})}return a}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function v(t,e){if(null==t)return{};var r,n,a=function(t,e){if(null==t)return{};var r,n,a={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],0<=e.indexOf(r)||(a[r]=t[r]);return a}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],0<=e.indexOf(r)||Object.prototype.propertyIsEnumerable.call(t,r)&&(a[r]=t[r])}return a}function c(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function l(n){return function(){var t,e=a(n);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()){var r=a(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return c(this,t)}}function ie(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,s=t[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!e||r.length!==e);n=!0);}catch(t){a=!0,o=t}finally{try{n||null==s["return"]||s["return"]()}finally{if(a)throw o}}return r}(t,e)||u(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function W(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||u(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){if(t){if("string"==typeof t)return h(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(t,e):void 0}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function bt(t){return null==t}function U(t){return"function"==typeof t}function xt(t){return U(t)?function(){t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}:function(){}}var ot=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},x=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(t){clearTimeout(t)},t=Array.prototype,L=t.forEach,f=t.slice,d=t.map,y=t.reduce,se=console.warn,mt=function(t){return null!=t},p=function(){function o(t){if(i(this,o),"string"==typeof t){var e=document.querySelectorAll(t);this.length=e.length;for(var r=0;r<this.length;r++)this[r]=e[r]}else if("object"!==pt(t)||1!==t.nodeType&&t!==document)if(t instanceof o){this.length=t.length;for(var n=0;n<this.length;n++)this[n]=t[n]}else{if(!function(t){return mt(t)&&"object"===pt(t)&&(Array.isArray(t)||mt(window.Symbol)&&"function"==typeof t[window.Symbol.iterator]||mt(t.forEach)||"number"==typeof t.length&&(0===t.length||0<t.length&&t.length-1 in t))}(t))throw new Error("Passed parameter must be selector/element/elementArray");for(var a=this.length=0;a<this.length;a++)1===t.nodeType&&(this[a]=t[a],this.length++)}else this[0]=t,this.length=1}return r(o,[{key:"css",value:function(r){var t={setStyle:function(t){return function(t,e){for(var r=t.length;r--;)for(var n in e)t[r].style[n]=e[n];return t.style}(this,t)},getStyle:function(){return function(t){for(var e=t.length;e--;)return t[e].currentStyle?t[e].currentStyle[r]:document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t[e],"")[r]:t[e].style[r]}(this)}};return"string"==typeof r?t.getStyle.apply(this,f.call(arguments,1)):"object"!==pt(r)&&r?(se("Method ".concat(r," does not exist")),!1):t.setStyle.apply(this,arguments)}},{key:"on",value:function(t,e,r,n){for(var a=this.length;a--;)this[a].events||(this[a].events={},this[a].events[t]=[]),"string"!=typeof e?document.addEventListener?this[a].addEventListener(t,e,r||{passive:!1}):document.attachEvent?this[a].attachEvent("on".concat(t),e):this[a]["on".concat(t)]=e:b(this[a],t,e,r,n,!0);return this}},{key:"off",value:function(t,e,r,n){for(var a=this.length;a--;)this[a].events||(this[a].events={},this[a].events[t]=[]),"string"!=typeof e?document.removeEventListener?this[a].removeEventListener(t,e,r):document.detachEvent?this[a].detachEvent("on".concat(t),e):this[a]["on".concat(t)]=null:b(this[a],t,e,r,n,!1);return this}},{key:"is",value:function(t){if(bt(t))return!1;for(var e=gt(t),r=this.length;r--;)if(this[r]===e[r])return!0;return!1}}]),o}();function b(t,e,r,n,a,o){function i(t){for(var e=t.target;e&&e!==this;)e.matches(r)&&n.call(e,t),e=e.parentNode}!0===o?document.addEventListener?t.addEventListener(e,i,a||{passive:!1}):document.attachEvent?t.attachEvent("on".concat(e),i):t["on".concat(e)]=i:document.removeEventListener?t.removeEventListener(e,i,a||{passive:!1}):document.detachEvent?t.detachEvent("on".concat(e),i):t["on".concat(e)]=null}function gt(t){return new p(t)}function it(t,e){if(0===e)return t;var r=E(t,e);return r-t<e?r:void 0}function ce(t,e){var r=1<arguments.length&&void 0!==e?e:6;return Number(t.toFixed(r))}function H(t){return t.getBoundingClientRect()}function V(t){return t.css("-webkit-transform")||t.css("-moz-transform")||t.css("-ms-transform")||t.css("-o-transform")||t.css("transform")||"none"}function z(t){var e=t.match(/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g);return e?e.map(function(t){return parseFloat(t)}):[1,0,0,1,0,0]}function wt(e,t){if(t){if(e.classList){if(!(-1<t.indexOf(" ")))return e.classList.add(t);t.split(/\s+/).forEach(function(t){return e.classList.add(t)})}return e}}function I(e,t){if(t){if(e.classList){if(!(-1<t.indexOf(" ")))return e.classList.remove(t);t.split(/\s+/).forEach(function(t){return e.classList.remove(t)})}return e}}function k(t){var e="matrix(".concat(t.join(),")");return{transform:e,webkitTranform:e,mozTransform:e,msTransform:e,otransform:e}}var m=function(){function t(){i(this,t),this.observers={}}return r(t,[{key:"subscribe",value:function(t,e){var r=this.observers;return bt(r[t])&&Object.defineProperty(r,t,{value:[]}),r[t].push(e),this}},{key:"unsubscribe",value:function(t,e){var r=this.observers;if(mt(r[t])){var n=r[t].indexOf(e);r[t].splice(n,1)}return this}},{key:"notify",value:function(e,r,n){bt(this.observers[e])||this.observers[e].forEach(function(t){if(r!==t)switch(e){case"onmove":t.notifyMove(n);break;case"onrotate":t.notifyRotate(n);break;case"onresize":t.notifyResize(n);break;case"onapply":t.notifyApply(n);break;case"ongetstate":t.notifyGetState(n)}})}}]),t}(),g=function(){function e(t){i(this,e),this.name=t,this.callbacks=[]}return r(e,[{key:"registerCallback",value:function(t){this.callbacks.push(t)}},{key:"removeCallback",value:function(t){var e=this.callbacks(t);this.callbacks.splice(e,1)}}]),e}(),w=function(){function t(){i(this,t),this.events={}}return r(t,[{key:"registerEvent",value:function(t){this.events[t]=new g(t)}},{key:"emit",value:function(e,t,r){this.events[t].callbacks.forEach(function(t){t.call(e,r)})}},{key:"addEventListener",value:function(t,e){this.events[t].registerCallback(e)}},{key:"removeEventListener",value:function(t,e){this.events[t].removeCallback(e)}}]),t}(),_=function(){function e(t){i(this,e),this.el=t,this.storage=null,this.proxyMethods=null,this.eventDispatcher=new w,this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._animate=this._animate.bind(this)}return r(e,[{key:"enable",value:function(t){this._processOptions(t),this._init(this.el),this.proxyMethods.onInit.call(this,this.el)}},{key:"disable",value:function(){M()}},{key:"_init",value:function(){M()}},{key:"_destroy",value:function(){M()}},{key:"_processOptions",value:function(){M()}},{key:"_start",value:function(){M()}},{key:"_moving",value:function(){M()}},{key:"_end",value:function(){M()}},{key:"_animate",value:function(){M()}},{key:"_drag",value:function(t){var e=t.dx,r=t.dy,n=v(t,["dx","dy"]),a=this._processMove(e,r),o=at({dx:e,dy:r,transform:a.transform},n,{},a.fixedDeltas);this.proxyMethods.onMove.call(this,o),this._emitEvent("drag",o)}},{key:"_draw",value:function(){this._animate()}},{key:"_onMouseDown",value:function(t){this._start(t),gt(document).on("mousemove",this._onMouseMove).on("mouseup",this._onMouseUp)}},{key:"_onTouchStart",value:function(t){this._start(t.touches[0]),gt(document).on("touchmove",this._onTouchMove).on("touchend",this._onTouchEnd)}},{key:"_onMouseMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t,this.el)}},{key:"_onTouchMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t.touches[0],this.el)}},{key:"_onMouseUp",value:function(t){gt(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp),this._end(t,this.el)}},{key:"_onTouchEnd",value:function(t){gt(document).off("touchmove",this._onTouchMove).off("touchend",this._onTouchEnd),0===t.touches.length&&this._end(t.changedTouches[0],this.el)}},{key:"_emitEvent",value:function(){var t;(t=this.eventDispatcher).emit.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"on",value:function(t,e){return this.eventDispatcher.addEventListener(t,e),this}},{key:"off",value:function(t,e){return this.eventDispatcher.removeEventListener(t,e),this}}]),e}(),M=function(){throw Error("Method not implemented")},j=["dragStart","drag","dragEnd","resizeStart","resize","resizeEnd","rotateStart","rotate","rotateEnd","setPointStart","setPointEnd"],_t=Math.PI/180,E=function(t,e){return 0===e?t:Math.round(t/e)*e},S=G("svg").createSVGPoint(),A=/[+-]?\d+(\.\d+)?/g,q=["circle","ellipse","image","line","path","polygon","polyline","rect","text","g","foreignobject"];function G(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function nt(){return G("svg").createSVGMatrix()}function st(t,e){return(e.getScreenCTM()||nt()).inverse().multiply(t.getScreenCTM()||nt())}function K(t){var e=t.a,r=t.b,n=t.c,a=t.d,o=t.e,i=t.f;return"matrix(".concat(e,",").concat(r,",").concat(n,",").concat(a,",").concat(o,",").concat(i,")")}function le(t,e,r){return S.x=e,S.y=r,S.matrixTransform(t)}function ue(t){var e=nt();return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f,e}function ct(t){return t.match(A).reduce(function(t,e,r,n){return r%2==0&&t.push(n.slice(r,r+2)),t},[])}function C(t,e){var r=t.x,n=t.y,a=ie(e,6),o=a[0],i=a[1],s=a[2],c=a[3];return{x:o*r+s*n+a[4],y:i*r+c*n+a[5]}}function D(t){var e=[[t[0],t[2],t[4]],[t[1],t[3],t[5]],[0,0,1]];if(e.length===e[0].length){for(var r=e.length,n=[],a=[],o=0;o<r;o+=1){n[n.length]=[],a[a.length]=[];for(var i=0;i<r;i+=1)n[o][i]=o==i?1:0,a[o][i]=e[o][i]}for(var s=0;s<r;s+=1){var c=a[s][s];if(0===c){for(var l=s+1;l<r;l+=1)if(0!==a[l][s]){for(var u=0;u<r;u++)c=a[s][u],a[s][u]=a[l][u],a[l][u]=c,c=n[s][u],n[s][u]=n[l][u],n[l][u]=c;break}if(0===(c=a[s][s]))return}for(var h=0;h<r;h++)a[s][h]=a[s][h]/c,n[s][h]=n[s][h]/c;for(var f=0;f<r;f++)if(f!=s){c=a[f][s];for(var v=0;v<r;v++)a[f][v]-=c*a[s][v],n[f][v]-=c*n[s][v]}}return[n[0][0],n[1][0],n[0][1],n[1][1],n[0][2],n[1][2]]}}function R(t,e){for(var r=ie(t,6),n=r[0],a=r[1],o=r[2],i=r[3],s=r[4],c=r[5],l=ie(e,6),u=l[0],h=l[1],f=l[2],v=l[3],d=[[n,o,s],[a,i,c],[0,0,1]],y=[[u,f,l[4]],[h,v,l[5]],[0,0,1]],p=[],b=0;b<y.length;b++){p[b]=[];for(var x=0;x<d[0].length;x++){for(var m=0,g=0;g<d.length;g++)m+=d[g][x]*y[b][g];p[b].push(m)}}return[p[0][0],p[1][0],p[0][1],p[1][1],p[0][2],p[1][2]]}function X(t,e,r,n,a,o,i,s,c){var l=parseFloat(r)/2,u=parseFloat(n)/2,h=t+l,f=e+u,v=t-h,d=e-f,y=Math.atan2(s?0:d,c?0:v)+a,p=Math.sqrt(Math.pow(c?0:l,2)+Math.pow(s?0:u,2)),b=Math.cos(y),x=Math.sin(y),m=f+p*(x=!0===i?-x:x);return{left:ce(h+p*(b=!0===o?-b:b)),top:ce(m)}}function he(t){for(var e=F.lastIndex=0,r=[];e=F.exec(t);){var n=e[1],a=n.toUpperCase(),o=e[2].replace(/([^e])-/g,"$1 -").replace(/ +/g," ");r.push({relative:n!==a,key:a,cmd:n,values:o.trim().split(B).map(function(t){if(!isNaN(t))return Number(t)})})}return r}var Q=function(t){return"g"===t.tagName.toLowerCase()},T=function(){s(o,_);var a=l(o);function o(t,e,r){var n;if(i(this,o),(n=a.call(this,t)).constructor===o)throw new TypeError("Cannot construct Transformable instances directly");return n.observable=r,j.forEach(function(t){n.eventDispatcher.registerEvent(t)}),n.enable(e),n}return r(o,[{key:"_cursorPoint",value:function(){throw Error("'_cursorPoint()' method not implemented")}},{key:"_rotate",value:function(t){var e=t.radians,r=v(t,["radians"]),n=at({transform:this._processRotate(e),delta:e},r);this.proxyMethods.onRotate.call(this,n),this._emitEvent("rotate",n)}},{key:"_resize",value:function(t){var e=t.dx,r=t.dy,n=v(t,["dx","dy"]),a=at({},this._processResize(e,r),{dx:e,dy:r},n);this.proxyMethods.onResize.call(this,a),this._emitEvent("resize",a)}},{key:"_processOptions",value:function(t){var e=this.el;wt(e,"sjx-drag");var r={x:10,y:10,angle:10*_t},n={move:!1,resize:!1,rotate:!1},a=null,o=!1,i=!1,s="xy",c=!1,l=5,u="old",h=!0,f=!1,v=!1,d=!1,y="auto",p="auto",b="auto",x=!1,m=!0,g=!0,w=!0,_=null,k=50,M=!0,j=null,E=function(){},S=function(){},A=function(){},T=function(){},O=function(){},V=function(){},z=e.parentNode;if(mt(t)){var C=t.snap,D=t.each,R=t.axis,X=t.cursorMove,Y=t.cursorResize,P=t.cursorRotate,N=t.rotationPoint,F=t.restrict,B=t.draggable,L=t.resizable,H=t.rotatable,W=t.onInit,I=t.onDrop,q=t.onMove,U=t.onResize,G=t.onRotate,Q=t.onDestroy,Z=t.container,$=t.proportions,J=t.keepTransformations,K=t.custom,tt=t.rotatorAnchor,et=t.rotatorOffset,rt=t.showNormal,nt=t.withoutScaling,at=t.minSize,ot=t.minSizeMode,it=t.allowReversing,st=t.minStartDistance,ct=t.processMove,lt=t.processResize;if(mt(C)){var ut=C.x,ht=C.y,ft=C.angle;r.x=bt(ut)?10:ut,r.y=bt(ht)?10:ht,r.angle=bt(ft)?r.angle:ft*_t}if(mt(D)){var vt=D.move,dt=D.resize,yt=D.rotate;n.move=vt||!1,n.resize=dt||!1,n.rotate=yt||!1}mt(F)&&(a="parent"===F?e.parentNode:gt(F)[0]||document),y=X||"auto",p=Y||"auto",b=P||"auto",s=R||"xy",z=mt(Z)&&gt(Z)[0]?gt(Z)[0]:z,x=N||!1,o=$||!1,i="boolean"==typeof J?J:function(t){return["g","svg","rect","foreignobject"].includes(t.tagName.toLowerCase())}(e),c=nt||!1,l=at||5,u=ot||"old",h=it||!0,d=st||!1,f=ct||!1,v=lt||!1,m=!mt(B)||B,g=!mt(L)||L,w=!mt(H)||H,j="object"===pt(K)&&K||null,_=tt||null,k=et||50,M=!mt(rt)||rt,E=xt(W),O=xt(I),S=xt(q),T=xt(U),A=xt(G),V=xt(Q)}this.options={axis:s,cursorMove:y,cursorRotate:b,cursorResize:p,rotationPoint:x,restrict:a,container:z,snap:r,each:n,proportions:o,keepTransformations:i,draggable:m,resizable:g,rotatable:w,custom:j,rotatorAnchor:_,rotatorOffset:k,showNormal:M,withoutScaling:c,minSize:l,minSizeMode:u,allowReversing:h,minStartDistance:d,processMove:f,processResize:v},this.proxyMethods={onInit:E,onDrop:O,onMove:S,onResize:T,onRotate:A,onDestroy:V},this.subscribe(n)}},{key:"_animate",value:function(){var t=this,e=t.observable,r=t.storage,n=t.options;if(!bt(r)&&(r.frame=ot(t._animate),r.doDraw)){r.doDraw=!1;var a=r.dox,o=r.doy,i=r.clientX,s=r.clientY,c=r.doDrag,l=r.doResize,u=r.doRotate,h=r.doSetCenter,f=r.revX,v=r.revY,d=n.snap,y=n.each,p=y.move,b=y.resize,x=y.rotate,m=n.restrict,g=n.draggable,w=n.resizable,_=n.rotatable;if(l&&w){var k=r.transform,M=r.cx,j=r.cy,E=this._pointToElement({x:i,y:s}),S=E.x,A=E.y,T=a?it(S-M,d.x/k.scX):0,O=o?it(A-j,d.y/k.scY):0,V={dx:T=a?f?-T:T:0,dy:O=o?v?-O:O:0,clientX:i,clientY:s};t._resize(V),b&&e.notify("onresize",t,V)}if(c&&g){var z=r.restrictOffset,C=r.elementOffset,D=r.nx,R=r.ny;if(mt(m)){var X=z.left,Y=z.top,P=C.left,N=C.top,F=C.width,B=C.height,L=D-i,H=R-s,W=m.clientWidth-F,I=m.clientHeight-B,q=N-Y,U=P-X;q-H<0&&(s=R-N+Y),U-L<0&&(i=D-P+X),I<q-H&&(s=I+(R-N+Y)),W<U-L&&(i=W+(D-P+X))}var G={dx:a?it(i-D,d.x):0,dy:o?it(s-R,d.y):0,clientX:i,clientY:s};t._drag(G),p&&e.notify("onmove",t,G)}if(u&&_){var Q=r.pressang,Z=r.center,$=Math.atan2(s-Z.y,i-Z.x)-Q,J={clientX:i,clientY:s};t._rotate(at({radians:it($,d.angle)},J)),x&&e.notify("onrotate",t,at({radians:$},J))}if(h&&_){var K=r.bx,tt=r.by,et=this._pointToControls({x:i,y:s}),rt=et.x,nt=et.y;t._moveCenterHandle(rt-K,nt-tt)}}}},{key:"_start",value:function(t){var e=this.observable,r=this.storage,n=this.options,a=n.axis,o=n.restrict,i=n.each,s=this.el,c=this._compute(t);Object.keys(c).forEach(function(t){r[t]=c[t]});var l=c.onRightEdge,u=c.onBottomEdge,h=c.onTopEdge,f=c.onLeftEdge,v=c.handle,d=c.factor,y=c.revX,p=c.revY,b=c.doW,x=c.doH,m=l||u||h||f,g=r.handles,w=g.rotator,_=g.center,k=g.radius;mt(k)&&I(k,"sjx-hidden");var M=v.is(w)||w&&v.is(w.firstElementChild),j=!!mt(_)&&v.is(_),E=!(M||m||j),S=t.clientX,A=t.clientY,T=this._cursorPoint({clientX:S,clientY:A}),O=T.x,V=T.y,z=this._pointToElement({x:O,y:V}),C=z.x,D=z.y,R=this._pointToControls({x:O,y:V}),X={clientX:S,clientY:A,nx:O,ny:V,cx:C,cy:D,bx:R.x,by:R.y,doResize:m,doDrag:E,doRotate:M,doSetCenter:j,onExecution:!0,cursor:null,elementOffset:H(s),restrictOffset:mt(o)?H(o):null,dox:/\x/.test(a)&&(!m||(v.is(g.ml)||v.is(g.mr)||v.is(g.tl)||v.is(g.tr)||v.is(g.bl)||v.is(g.br))),doy:/\y/.test(a)&&(!m||(v.is(g.br)||v.is(g.bl)||v.is(g.bc)||v.is(g.tr)||v.is(g.tl)||v.is(g.tc)))};this.storage=at({},r,{},X);var Y={clientX:S,clientY:A};m?this._emitEvent("resizeStart",Y):M?this._emitEvent("rotateStart",Y):E&&this._emitEvent("dragStart",Y);var P=i.move,N=i.resize,F=i.rotate,B=m?"resize":M?"rotate":"drag",L=m&&N||M&&F||E&&P;e.notify("ongetstate",this,{clientX:S,clientY:A,actionName:B,triggerEvent:L,factor:d,revX:y,revY:p,doW:b,doH:x}),this._draw()}},{key:"_moving",value:function(t){var e=this.storage,r=this.options,n=this._cursorPoint(t),a=n.x,o=n.y;e.e=t,e.clientX=a,e.clientY=o,e.doDraw=!0;var i=e.doRotate,s=e.doDrag,c=e.doResize,l=e.cursor,u=r.cursorMove,h=r.cursorResize,f=r.cursorRotate;bt(l)&&(s?l=u:i?l=f:c&&(l=h),gt(document.body).css({cursor:l}))}},{key:"_end",value:function(t){var e=t.clientX,r=t.clientY,n=this.options.each,a=this.observable,o=this.storage,i=this.proxyMethods,s=o.doResize,c=o.doDrag,l=o.doRotate,u=o.frame,h=o.handles.radius,f=s?"resize":c?"drag":"rotate";o.doResize=!1,o.doDrag=!1,o.doRotate=!1,o.doSetCenter=!1,o.doDraw=!1,o.onExecution=!1,o.cursor=null,this._apply(f);var v={clientX:e,clientY:r};i.onDrop.call(this,v),s?this._emitEvent("resizeEnd",v):l?this._emitEvent("rotateEnd",v):c&&this._emitEvent("dragEnd",v),o.outOfSnap=!1;var d=n.move,y=n.resize,p=n.rotate,b=s&&y||l&&p||c&&d;a.notify("onapply",this,{clientX:e,clientY:r,actionName:f,triggerEvent:b}),x(u),gt(document.body).css({cursor:"auto"}),mt(h)&&wt(h,"sjx-hidden")}},{key:"_compute",value:function(t){var e=this.storage.handles,r=gt(t.target),n=this._checkHandles(r,e),a=n.revX,o=n.revY,i=n.doW,s=n.doH,c=v(n,["revX","revY","doW","doH"]),l=this._getState({revX:a,revY:o,doW:i,doH:s}),u=this._cursorPoint(t),h=u.x,f=u.y;return at({},l,{},c,{handle:r,pressang:Math.atan2(f-l.center.y,h-l.center.x)})}},{key:"_checkHandles",value:function(t,e){var r=e.tl,n=e.tc,a=e.tr,o=e.bl,i=e.br,s=e.bc,c=e.ml,l=e.mr,u=!!mt(r)&&t.is(r),h=!!mt(n)&&t.is(n),f=!!mt(a)&&t.is(a),v=!!mt(o)&&t.is(o),d=!!mt(s)&&t.is(s),y=!!mt(i)&&t.is(i),p=!!mt(c)&&t.is(c),b=!!mt(l)&&t.is(l);return{revX:u||p||v||h,revY:u||f||h||p,onTopEdge:h||f||u,onLeftEdge:u||p||v,onRightEdge:f||b||y,onBottomEdge:y||d||v,doW:p||b,doH:h||d}}},{key:"notifyMove",value:function(){this._drag.apply(this,arguments)}},{key:"notifyRotate",value:function(t){var e=t.radians,r=v(t,["radians"]),n=this.options.snap.angle;this._rotate(at({radians:it(e,n)},r))}},{key:"notifyResize",value:function(){this._resize.apply(this,arguments)}},{key:"notifyApply",value:function(t){var e=t.clientX,r=t.clientY,n=t.actionName,a=t.triggerEvent;this.proxyMethods.onDrop.call(this,{clientX:e,clientY:r}),a&&(this._apply(n),this._emitEvent("".concat(n,"End"),{clientX:e,clientY:r}))}},{key:"notifyGetState",value:function(t){var e=t.clientX,r=t.clientY,n=t.actionName,a=t.triggerEvent,o=v(t,["clientX","clientY","actionName","triggerEvent"]);if(a){var i=this._getState(o);this.storage=at({},this.storage,{},i),this._emitEvent("".concat(n,"Start"),{clientX:e,clientY:r})}}},{key:"subscribe",value:function(t){var e=t.resize,r=t.move,n=t.rotate,a=this.observable;(r||e||n)&&a.subscribe("ongetstate",this).subscribe("onapply",this),r&&a.subscribe("onmove",this),e&&a.subscribe("onresize",this),n&&a.subscribe("onrotate",this)}},{key:"unsubscribe",value:function(){this.observable.unsubscribe("ongetstate",this).unsubscribe("onapply",this).unsubscribe("onmove",this).unsubscribe("onresize",this).unsubscribe("onrotate",this)}},{key:"disable",value:function(t,e){var r=this.storage,n=this.proxyMethods,a=this.el;bt(r)||(r.onExecution&&(this._end({clientX:t,clientY:e}),gt(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp).off("touchmove",this._onTouchMove).off("touchend",this._onTouchEnd)),I(a,"sjx-drag"),this._destroy(),this.unsubscribe(),n.onDestroy.call(this,a),delete this.storage)}},{key:"exeDrag",value:function(t){var e=t.dx,r=t.dy;this.options.draggable&&(this.storage=at({},this.storage,{},this._getState({revX:!1,revY:!1,doW:!1,doH:!1})),this._drag({dx:e,dy:r}),this._apply("drag"))}},{key:"exeResize",value:function(t){var e=t.dx,r=t.dy,n=t.revX,a=t.revY,o=t.doW,i=t.doH;this.options.resizable&&(this.storage=at({},this.storage,{},this._getState({revX:n||!1,revY:a||!1,doW:o||!1,doH:i||!1})),this._resize({dx:e,dy:r}),this._apply("resize"))}},{key:"exeRotate",value:function(t){var e=t.delta;this.options.rotatable&&(this.storage=at({},this.storage,{},this._getState({revX:!1,revY:!1,doW:!1,doH:!1})),this._rotate({radians:e}),this._apply("rotate"))}}]),o}(),O=2,Y=7,P=function(){s(e,T);var t=l(e);function e(){return i(this,e),t.apply(this,arguments)}return r(e,[{key:"_init",value:function(t){var e=this.options,r=e.rotationPoint,n=e.container,a=e.resizable,o=e.rotatable,i=e.showNormal,s=t.style,c=s.left,l=s.top,u=s.width,h=s.height,f=document.createElement("div");wt(f,"sjx-wrapper"),n.appendChild(f);var v=gt(t),d=u||v.css("width"),y=h||v.css("height"),p={top:l||v.css("top"),left:c||v.css("left"),width:d,height:y,transform:V(v)},b=document.createElement("div");wt(b,"sjx-controls");var x=at({},o&&{normal:i?["sjx-normal"]:null,rotator:["sjx-hdl","sjx-hdl-m","sjx-rotator"]},{},a&&{tl:["sjx-hdl","sjx-hdl-t","sjx-hdl-l","sjx-hdl-tl"],tr:["sjx-hdl","sjx-hdl-t","sjx-hdl-r","sjx-hdl-tr"],br:["sjx-hdl","sjx-hdl-b","sjx-hdl-r","sjx-hdl-br"],bl:["sjx-hdl","sjx-hdl-b","sjx-hdl-l","sjx-hdl-bl"],tc:["sjx-hdl","sjx-hdl-t","sjx-hdl-c","sjx-hdl-tc"],bc:["sjx-hdl","sjx-hdl-b","sjx-hdl-c","sjx-hdl-bc"],ml:["sjx-hdl","sjx-hdl-m","sjx-hdl-l","sjx-hdl-ml"],mr:["sjx-hdl","sjx-hdl-m","sjx-hdl-r","sjx-hdl-mr"]},{center:r&&o?["sjx-hdl","sjx-hdl-m","sjx-hdl-c","sjx-hdl-mc"]:void 0});Object.keys(x).forEach(function(t){var e=x[t];if(!bt(e)){var r=N(e);x[t]=r,b.appendChild(r)}}),mt(x.center)&&gt(x.center).css({left:"".concat(t.getAttribute("data-cx"),"px"),top:"".concat(t.getAttribute("data-cy"),"px")});f.appendChild(b);var m=gt(b);m.css(p),this.storage={controls:b,handles:x,radius:void 0,parent:t.parentNode},m.on("mousedown",this._onMouseDown).on("touchstart",this._onTouchStart)}},{key:"_destroy",value:function(){var t=this.storage.controls;gt(t).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart);var e=t.parentNode;e.parentNode.removeChild(e)}},{key:"_pointToElement",value:function(t){var e=t.x,r=t.y,n=W(this.storage.transform.matrix);return n[4]=n[5]=0,this._applyMatrixToPoint(D(n),e,r)}},{key:"_pointToControls",value:function(t){return this._pointToElement(t)}},{key:"_applyMatrixToPoint",value:function(t,e,r){return C({x:e,y:r},t)}},{key:"_cursorPoint",value:function(t){var e=t.clientX,r=t.clientY,n=this.options.container,a=z(V(gt(n)));return C({x:e,y:r},D(a))}},{key:"_apply",value:function(){var t=this.el,e=this.storage,r=e.controls,n=e.handles,a=gt(r),o=parseFloat(a.css("width"))/2,i=parseFloat(a.css("height"))/2,s=n.center,c=mt(s),l=c?parseFloat(gt(s).css("left")):o,u=c?parseFloat(gt(s).css("top")):i;t.setAttribute("data-cx",l),t.setAttribute("data-cy",u),this.storage.cached=null}},{key:"_processResize",value:function(t,e){var r=this.el,n=this.storage,a=this.options.proportions,o=n.controls,i=n.coords,s=n.cw,c=n.ch,l=n.transform,u=n.refang,h=n.revX,f=n.revY,v=n.doW,d=n.doH,y=v||!v&&!d?(s+t)/s:(c+e)/c,p=a?s*y:s+t,b=a?c*y:c+e;if(!(p<=O||b<=O)){var x=W(l.matrix),m=X(x[4],x[5],p,b,u,h,f,v,d),g=i.left-m.left,w=i.top-m.top;x[4]+=g,x[5]+=w;var _=k(x);return _.width="".concat(p,"px"),_.height="".concat(b,"px"),gt(o).css(_),gt(r).css(_),n.cached={dx:g,dy:w},{width:p,height:b,ox:g,oy:w}}}},{key:"_processMove",value:function(t,e){var r=this.el,n=this.storage,a=n.controls,o=n.transform,i=o.matrix,s=W(o.parentMatrix);s[4]=s[5]=0;var c=W(i);c[4]=i[4]+t,c[5]=i[5]+e;var l=k(c);return gt(a).css(l),gt(r).css(l),n.cached={dx:t,dy:e},c}},{key:"_processRotate",value:function(t){var e=this.el,r=this.storage,n=r.controls,a=r.transform,o=r.center,i=a.matrix,s=a.parentMatrix,c=ce(Math.cos(t),4),l=ce(Math.sin(t),4),u=[1,0,0,1,o.cx,o.cy],h=[c,l,-l,c,0,0],f=W(s);f[4]=f[5]=0;var v=R(D(f),R(h,f)),d=R(R(u,v),D(u)),y=R(d,i),p=k(y);return gt(n).css(p),gt(e).css(p),y}},{key:"_getState",value:function(t){var e=t.revX,r=t.revY,n=t.doW,a=t.doH,o=e!==r?-1:1,i=this.el,s=this.storage,c=s.handles,l=s.controls,u=s.parent,h=this.options.container,f=c.center,v=gt(l),d=z(V(gt(h))),y=z(V(gt(l))),p=z(V(gt(u))),b=Math.atan2(y[1],y[0])*o,x=u!==h?R(p,d):d,m={matrix:y,parentMatrix:x,scX:Math.sqrt(y[0]*y[0]+y[1]*y[1]),scY:Math.sqrt(y[2]*y[2]+y[3]*y[3])},g=parseFloat(v.css("width")),w=parseFloat(v.css("height")),_=X(y[4],y[5],g,w,b,e,r,n,a),k=g/2,M=w/2,j=H(i),E=mt(f),S=E?parseFloat(gt(f).css("left")):k,A=E?parseFloat(gt(f).css("top")):M,T=E?Y:0,O=C({x:j.left,y:j.top},D(x));return{transform:m,cw:g,ch:w,coords:_,center:{x:O.x+S-T,y:O.y+A-T,cx:-S+k-T,cy:-A+M-T,hx:S,hy:A},factor:o,refang:b,revX:e,revY:r,doW:n,doH:a}}},{key:"_moveCenterHandle",value:function(t,e){var r=this.storage,n=r.handles.center,a=r.center,o=a.hx,i=a.hy,s="".concat(o+t,"px"),c="".concat(i+e,"px");gt(n).css({left:s,top:c})}},{key:"resetCenterPoint",value:function(){gt(this.storage.handles.center).css({left:null,top:null})}},{key:"fitControlsToSize",value:function(){}},{key:"controls",get:function(){return this.storage.controls}}]),e}(),N=function(t){var e=document.createElement("div");return t.forEach(function(t){wt(e,t)}),e},F=/\s*([achlmqstvz])([^achlmqstvz]*)\s*/gi,B=/\s*,\s*|\s+/g,Z="#00a8ff",$=function(){s(e,T);var t=l(e);function e(){return i(this,e),t.apply(this,arguments)}return r(e,[{key:"_init",value:function(t){var e=this.options,r=e.rotationPoint,n=e.container,a=e.resizable,o=e.rotatable,i=e.rotatorAnchor,s=e.rotatorOffset,c=e.showNormal,l=e.custom,u=G("g");wt(u,"sjx-svg-wrapper"),wt(u,t.nodeName),n.appendChild(u);var h=t.getBBox(),f=h.width,v=h.height,d=h.x,y=h.y,p=st(t,n),b=G("rect");[["width",f],["height",v],["x",d],["y",y],["fill",Z],["fill-opacity",0],["stroke",Z],["stroke-dasharray","3 3"],["vector-effect","non-scaling-stroke"],["transform",K(p)]].forEach(function(t){var e=ie(t,2),r=e[0],n=e[1];b.setAttribute(r,n)});var x=G("g"),m=G("g"),g=G("g");wt(g,"sjx-svg-box-group"),wt(x,"sjx-svg-handles"),wt(m,"sjx-svg-normal-group"),g.appendChild(b),u.appendChild(g),u.appendChild(m),u.appendChild(x);var w=b.getBBox(),_=w.x,k=w.y,M=w.width,j=w.height,E=t.getAttribute("data-cx"),S=t.getAttribute("data-cy"),A=st(b,b.parentNode),T=le(A,_+M/2,k+j/2),O=le(A,_,k),V=le(A,_+M,k),z=le(A,_+M,k+j/2),C=le(A,_,k+j/2),D=le(A,_+M/2,k),R=le(A,_+M/2,k+j),X=le(A,_+M,k+j),Y=le(A,_,k+j),P={tl:O,tr:V,br:X,bl:Y,tc:D,bc:R,ml:C,mr:z},N={},F=null;if(o){var B={},L=1;switch(i){case"n":B.x=D.x,B.y=D.y;break;case"s":B.x=R.x,B.y=R.y,L=-1;break;case"w":B.x=C.x,B.y=C.y,L=-1;break;case"e":default:B.x=z.x,B.y=z.y}var H="n"===i||"s"===i?Math.atan2(Y.y-O.y,Y.x-O.x):Math.atan2(O.y-V.y,O.x-V.x);F={x:B.x-s*L*Math.cos(H),y:B.y-s*L*Math.sin(H)};var W=c?G("line"):null;c&&(W.x1.baseVal.value=B.x,W.y1.baseVal.value=B.y,W.x2.baseVal.value=F.x,W.y2.baseVal.value=F.y,lt(W,Z),m.appendChild(W));var I=null;r&&(I=G("line"),wt(I,"sjx-hidden"),I.x1.baseVal.value=T.x,I.y1.baseVal.value=T.y,I.x2.baseVal.value=E||T.x,I.y2.baseVal.value=S||T.y,lt(I,"#fe3232"),I.setAttribute("opacity",.5),m.appendChild(I)),N={normal:W,radius:I}}var q=at({},a&&P,{rotator:F,center:r&&o?function(t,e,r){if(bt(e)||bt(r))return null;var n=t.createSVGPoint();return n.x=e,n.y=r,n}(n,E,S)||T:void 0});Object.keys(q).forEach(function(t){var e=q[t];if(!bt(e)){var r=e.x,n=e.y,a="center"===t?"#fe3232":Z;mt(l)&&U(l[t])?q[t]=l[t](A,w,le):q[t]=rt(r,n,a,t),x.appendChild(q[t])}}),this.storage={wrapper:u,box:b,handles:at({},q,{},N),parent:t.parentNode},gt(u).on("mousedown",this._onMouseDown).on("touchstart",this._onTouchStart)}},{key:"fitTo",value:function(t,e){var r=this.options,n=this.storage,a=n.box;if(e){var o=parseFloat(a.getAttribute("height"));parseFloat(t.getAttribute("height"))<o&&t.setAttribute("height",o)}a.setAttribute("height",t.getAttribute("height"));var i=a.getBBox(),s=i.x,c=i.y;et(n,r,{x:s,y:c,width:parseFloat(a.getAttribute("width")),height:parseFloat(a.getAttribute("height")),boxMatrix:null})}},{key:"_destroy",value:function(){var t=this.storage.wrapper;gt(t).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart),t.parentNode.removeChild(t)}},{key:"_cursorPoint",value:function(t){var e=this.options.container,r=e.getBoundingClientRect(),n=e.getScreenCTM();return n.e=r.x,n.f=r.y,le(n.inverse(),t.clientX,t.clientY)}},{key:"_pointToElement",value:function(t){var e=t.x,r=t.y,n=this.storage.transform.ctm.inverse();return n.e=n.f=0,this._applyMatrixToPoint(n,e,r)}},{key:"_pointToControls",value:function(t){var e=t.x,r=t.y,n=this.storage.transform.boxCTM.inverse();return n.e=n.f=0,this._applyMatrixToPoint(n,e,r)}},{key:"_applyMatrixToPoint",value:function(t,e,r){var n=this.options.container.createSVGPoint();return n.x=e,n.y=r,n.matrixTransform(t)}},{key:"_apply",value:function(t){var e=this.el,r=this.storage,n=this.options,a=this.options.container,o=r.box,i=r.handles,s=r.cached,c=r.transform,l=c.matrix,u=c.boxCTM,h=c.bBox,f=c.ctm,v=e.getBBox(),d=v.x,y=v.y,p=v.width,b=v.height,x=mt(i.center)?le(u,i.center.cx.baseVal.value,i.center.cy.baseVal.value):le(l,d+p/2,y+b/2);if(e.setAttribute("data-cx",x.x),e.setAttribute("data-cy",x.y),!bt(s)){var m=s.scaleX,g=s.scaleY,w=s.dx,_=s.dy;if("drag"===t){if(0===w&&0===_)return;var k=nt();k.e=w,k.f=_;var M=k.multiply(l).multiply(k.inverse());n.keepTransformations||(e.setAttribute("transform",K(M)),J(e,{x:w,y:_}))}if("resize"===t){var j=o.getBBox(),E=j.x,S=j.y,A=j.width,T=j.height;n.keepTransformations?this.storage.temporalCtm=f:(et(r,n,{x:E,y:S,width:A,height:T,boxMatrix:null}),tt(e,{scaleX:m,scaleY:g,defaultCTM:f,bBox:h,container:a,storage:r,withoutScaling:n.withoutScaling}),e.setAttribute("transform",K(l)))}this.storage.cached=null}}},{key:"_processResize",value:function(t,e){var r=this.el,n=this.storage,a=this.options,o=this.options,i=o.proportions,s=o.processResize,c=o.withoutScaling,l=o.minSize,u=o.minSizeMode,h=o.allowReversing,f=n.left,v=n.top,d=n.cw,y=n.ch,p=n.transform,b=n.revX,x=n.revY,m=n.doW,g=n.doH,w=p.matrix,_=p.scMatrix,k=p.trMatrix,M=p.scaleX,j=p.scaleY,E=r.getBBox(),S=E.width,A=E.height;r.dataset.temporalWidth&&(S=r.dataset.temporalWidth,A=r.dataset.temporalHeight);var T={};if(s){var O=s(t,e,b,x);T.fdx=t+(O&&O.x?O.x:0),T.fdy=e+(O&&O.y?O.y:0),t+=O&&O.x?O.x:0,e+=O&&O.y?O.y:0}var V=m||!m&&!g?(d+t)/d:(y+e)/y;S=i?d*V:d+t,A=i?y*V:y+e;var z={};if("number"==typeof l&&(z.width=l,z.height=l),"object"===pt(l)&&Object.prototype.hasOwnProperty.call(l,"width")&&Object.prototype.hasOwnProperty.call(l,"height")&&(z=l),!("old"===u&&(Math.abs(S)<=z.width||Math.abs(A)<=z.height)||(c||h)&&S<=0||(c||h)&&A<=0)){var C=S/d,D=A/y;if(_.a=C,_.b=0,_.c=0,_.d=D,_.e=0,_.f=0,k.e=M,k.f=j,c){var R=t<0?Math.abs(t):-Math.abs(t),X=e<0?Math.abs(e):-Math.abs(e);_.a=1,_.b=0,_.c=0,_.d=1,_.e=b?R:0,_.f=x?X:0}var Y=k.multiply(_).multiply(k.inverse()),P=w.multiply(Y),N=S-d,F=A-y,B=r.getBoundingClientRect(),L=B.width,H=B.height;if(!("new"===u&&Math.abs(L)<=z.width&&N<0||"new"===u&&Math.abs(H)<=z.height&&F<0)){var W=r.getAttribute("transform"),I=r.getAttribute("height"),q=r.getAttribute("width");r.setAttribute("transform",K(P)),c&&(r.setAttribute("width",S),r.setAttribute("height",A));var U=r.getBoundingClientRect(),G=U.height,Q=U.width;if("new"===u&&parseFloat(Math.abs(Q).toFixed(2))<parseFloat(z.width.toFixed(2)))return r.setAttribute("transform",W),r.setAttribute("height",I),void r.setAttribute("width",q);if("new"===u&&parseFloat(Math.abs(G).toFixed(2))<parseFloat(z.height.toFixed(2)))return r.setAttribute("transform",W),r.setAttribute("height",I),void r.setAttribute("width",q);var Z=f-N*(g?.5:b?1:0),$=v-F*(m?.5:x?1:0);this.storage.cached={scaleX:C,scaleY:D};var J=at({x:Z,y:$,width:S,height:A},T);return et(n,a,at({},J,{boxMatrix:null})),J}}}},{key:"_processMove",value:function(t,e){var r=this.storage,n=r.transform,a=r.wrapper,o=r.center,i=this.options,s=i.processMove,c=i.minStartDistance,l=n.matrix,u=n.trMatrix,h=n.scMatrix,f=n.wrapperMatrix,v=n.parentMatrix;!this.storage.outOfSnap&&c&&Math.abs(t)<c&&Math.abs(e)<c?e=t=0:this.storage.outOfSnap=!0,h.e=t,h.f=e;var d=h.multiply(f);a.setAttribute("transform",K(d)),v.e=v.f=0;var y=le(v.inverse(),t,e),p=y.x,b=y.y;u.e=p,u.f=b;var x=s&&s(p,b),m={fdx:t,fdy:e};if(x){var g=function(t,e,r,n,a){var o=Math.cos,i=Math.sin;return{x:(t-r)*o(a=a*Math.PI/180)-(e-n)*i(a)+r,y:(t-r)*i(a)+(e-n)*o(a)+n}}(x.x||0,x.y||0,0,0,x.rotation||0);d.e+=g.x,d.f+=g.y,a.setAttribute("transform",K(d)),u.e+=x.x/v.a||0,u.f+=x.y/v.d||0,m.fdx=t+x.x,m.fdy=e+x.y,t<0&&t>m.fdx?m.fdx=t:0<t&&t<m.fdx&&(m.fdx=t),e<0&&e>m.fdy?m.fdy=e:0<e&&e<m.fdy&&(m.fdy=e)}var w=u.multiply(l);if(this.el.setAttribute("transform",K(w)),this.storage.cached={dx:p,dy:b,ox:t,oy:e},o.isShifted){var _=f.inverse();_.e=_.f=0;var k=le(_,t,e),M=k.x,j=k.y;this._moveCenterHandle(-M,-j)}return{transform:w,fixedDeltas:m}}},{key:"_processRotate",value:function(t){var e=this.storage,r=e.center,n=e.transform,a=e.wrapper,o=n.matrix,i=n.wrapperMatrix,s=n.parentMatrix,c=n.trMatrix,l=n.scMatrix,u=n.rotMatrix,h=ce(Math.cos(t)),f=ce(Math.sin(t));c.e=r.x,c.f=r.y,u.a=h,u.b=f,u.c=-f,u.d=h;var v=c.multiply(u).multiply(c.inverse()).multiply(i);a.setAttribute("transform",K(v)),l.e=r.el_x,l.f=r.el_y,s.e=s.f=0;var d=s.inverse().multiply(u).multiply(s),y=l.multiply(d).multiply(l.inverse()).multiply(o);return this.el.setAttribute("transform",K(y)),y}},{key:"_getState",value:function(t){var e=t.revX,r=t.revY,n=t.doW,a=t.doH,o=this.el,i=this.storage,s=this.options.container,c=i.box,l=i.wrapper,u=i.parent,h=i.handles.center,f=o.getBBox(),v=f.x,d=f.y,y=f.width,p=f.height,b=c.getBBox(),x=b.width,m=b.height,g=b.x,w=b.y,_=st(o,u),k=i.temporalCtm||st(o,s),M=st(c.parentNode,s),j=st(u,s),E=v+y*(a?.5:e?1:0),S=d+p*(n?.5:r?1:0),A={matrix:_,ctm:k,boxCTM:M,parentMatrix:j,wrapperMatrix:st(l,l.parentNode),trMatrix:nt(),scMatrix:nt(),rotMatrix:nt(),scaleX:E,scaleY:S,scX:Math.sqrt(k.a*k.a+k.b*k.b),scY:Math.sqrt(k.c*k.c+k.d*k.d),bBox:f},T=g+x/2,O=w+m/2,V=h?h.cx.baseVal.value:T,z=h?h.cy.baseVal.value:O,C=le(M,V,z),D=C.x,R=C.y,X=mt(h)?le(j.inverse(),D,R):le(_,v+y/2,d+p/2),Y=X.x,P=X.y,N=le(st(c,s),T,O),F=N.x,B=N.y;return function r(t){var n=[];return Q(t)?L.call(t.childNodes,function(t){if(1===t.nodeType){var e=t.tagName.toLowerCase();-1!==q.indexOf(e)&&("g"===e&&n.push.apply(n,W(r(t))),n.push(t))}}):n.push(t),n}(o).forEach(function(t){t.__ctm__=st(t,s)}),{transform:A,cw:x,ch:m,center:{x:h?D:F,y:h?R:B,el_x:Y,el_y:P,hx:h?h.cx.baseVal.value:null,hy:h?h.cy.baseVal.value:null,isShifted:ce(F,3)!==ce(D,3)&&ce(B,3)!==ce(R,3)},left:g,top:w,revX:e,revY:r,doW:n,doH:a}}},{key:"_moveCenterHandle",value:function(t,e){var r=this.storage,n=r.handles,a=n.center,o=n.radius,i=r.center,s=i.hx,c=i.hy;if(!bt(a)){var l=s+t,u=c+e;a.cx.baseVal.value=l,a.cy.baseVal.value=u,o.x2.baseVal.value=l,o.y2.baseVal.value=u}}},{key:"resetCenterPoint",value:function(){var t=this.storage,e=t.box,r=t.handles,n=r.center,a=r.radius,o=e.getBBox(),i=o.width,s=o.height,c=o.x,l=o.y,u=st(e,e.parentNode),h=le(u,c+i/2,l+s/2),f=h.x,v=h.y;n.cx.baseVal.value=f,n.cy.baseVal.value=v,n.isShifted=!1,a.x2.baseVal.value=f,a.y2.baseVal.value=v}},{key:"fitControlsToSize",value:function(){var t=this.el,e=this.storage,r=e.box,n=e.wrapper,a=this.options.container,o=t.getBBox(),i=o.width,s=o.height,c=o.x,l=o.y;this.storage.ch=s;var u=st(t,a);n.removeAttribute("transform"),r.setAttribute("transform",K(u)),et(this.storage,this.options,{x:c,y:l,width:i,height:s,boxMatrix:u})}},{key:"controls",get:function(){return this.storage.wrapper}}]),e}(),J=function(e,t){var r=t.x,n=t.y,a=[];switch(e.tagName.toLowerCase()){case"text":var o=mt(e.x.baseVal[0])?e.x.baseVal[0].value+r:(Number(e.getAttribute("x"))||0)+r,i=mt(e.y.baseVal[0])?e.y.baseVal[0].value+n:(Number(e.getAttribute("y"))||0)+n;a.push(["x",o],["y",i]);break;case"use":case"image":case"rect":var s=mt(e.x.baseVal.value)?e.x.baseVal.value+r:(Number(e.getAttribute("x"))||0)+r,c=mt(e.y.baseVal.value)?e.y.baseVal.value+n:(Number(e.getAttribute("y"))||0)+n;a.push(["x",s],["y",c]);break;case"circle":case"ellipse":var l=e.cx.baseVal.value+r,u=e.cy.baseVal.value+n;a.push(["cx",l],["cy",u]);break;case"line":var h=e.x1.baseVal.value+r,f=e.y1.baseVal.value+n,v=e.x2.baseVal.value+r,d=e.y2.baseVal.value+n;a.push(["x1",h],["y1",f],["x2",v],["y2",d]);break;case"polygon":case"polyline":var y=ct(e.getAttribute("points")).map(function(t){return t[0]=Number(t[0])+r,t[1]=Number(t[1])+n,t.join(" ")}).join(" ");a.push(["points",y]);break;case"path":var p=e.getAttribute("d");a.push(["d",function(t){var e=t.path,r=t.dx,n=t.dy;try{for(var a=he(e),o="",i=" ",s=!0,c=0,l=a.length;c<l;c++){var u=a[c],h=u.values,f=u.key,v=u.relative,d=[];switch(f){case"M":for(var y=0,p=h.length;y<p;y+=2){var b=ie(h.slice(y,y+2),2),x=b[0],m=b[1];v&&!s||(x+=r,m+=n),d.push(x,m),s=!1}break;case"A":for(var g=0,w=h.length;g<w;g+=7){var _=h.slice(g,g+7);v||(_[5]+=r,_[6]+=n),d.push.apply(d,W(_))}break;case"C":for(var k=0,M=h.length;k<M;k+=6){var j=h.slice(k,k+6);v||(j[0]+=r,j[1]+=n,j[2]+=r,j[3]+=n,j[4]+=r,j[5]+=n),d.push.apply(d,W(j))}break;case"H":for(var E=0,S=h.length;E<S;E+=1){var A=h.slice(E,E+1);v||(A[0]+=r),d.push(A[0])}break;case"V":for(var T=0,O=h.length;T<O;T+=1){var V=h.slice(T,T+1);v||(V[0]+=n),d.push(V[0])}break;case"L":case"T":for(var z=0,C=h.length;z<C;z+=2){var D=ie(h.slice(z,z+2),2),R=D[0],X=D[1];v||(R+=r,X+=n),d.push(R,X)}break;case"Q":case"S":for(var Y=0,P=h.length;Y<P;Y+=4){var N=ie(h.slice(Y,Y+4),4),F=N[0],B=N[1],L=N[2],H=N[3];v||(F+=r,B+=n,L+=r,H+=n),d.push(F,B,L,H)}break;case"Z":i=h[0]=""}o+=u.cmd+d.join(",")+i}return o}catch(t){se("Path parsing error: "+t)}}({path:p,dx:r,dy:n})])}a.forEach(function(t){e.setAttribute(t[0],t[1])})},tt=function(a,t){var e=t.scaleX,r=t.scaleY,n=t.bBox,o=t.defaultCTM,i=t.container,s=t.withoutScaling,c=n.width,l=n.height,u=[],h=st(a,i),f=o.inverse().multiply(h);switch(a.tagName.toLowerCase()){case"text":var v=mt(a.x.baseVal[0])?a.x.baseVal[0].value:Number(a.getAttribute("x"))||0,d=mt(a.y.baseVal[0])?a.y.baseVal[0].value:Number(a.getAttribute("y"))||0,y=le(f,v,d),p=y.x,b=y.y;u.push(["x",p+(e<0?c:0)],["y",b+(r<0?l:0)]);break;case"circle":var x=a.r.baseVal.value,m=a.cx.baseVal.value,g=a.cy.baseVal.value,w=x*(Math.abs(e)+Math.abs(r))/2,_=le(f,m,g),k=_.x,M=_.y;u.push(["r",w],["cx",k],["cy",M]);break;case"image":case"foreignobject":case"rect":var j=a.width.baseVal.value,E=a.height.baseVal.value,S=a.x.baseVal.value,A=a.y.baseVal.value,T=le(f,S,A),O=T.x,V=T.y,z=Math.abs(j*e),C=Math.abs(E*r);u.push(["x",O-(e<0?z:0)],["y",V-(r<0?C:0)]),s||(a.dataset.scale=e,u.push(["width",z],["height",C]));break;case"ellipse":var D=a.rx.baseVal.value,R=a.ry.baseVal.value,X=a.cx.baseVal.value,Y=a.cy.baseVal.value,P=le(f,X,Y),N=P.x,F=P.y,B=nt();B.a=e,B.d=r;var L=le(B,D,R),H=L.x,W=L.y;u.push(["rx",Math.abs(H)],["ry",Math.abs(W)],["cx",N],["cy",F]);break;case"line":var I=a.x1.baseVal.value,q=a.y1.baseVal.value,U=a.x2.baseVal.value,G=a.y2.baseVal.value,Q=le(f,I,q),Z=Q.x,$=Q.y,J=le(f,U,G),K=J.x,tt=J.y;u.push(["x1",Z],["y1",$],["x2",K],["y2",tt]);break;case"polygon":case"polyline":var et=ct(a.getAttribute("points")).map(function(t){var e=le(f,Number(t[0]),Number(t[1])),r=e.x,n=e.y;return t[0]=r,t[1]=n,t.join(" ")}).join(" ");u.push(["points",et]);break;case"path":var rt=a.getAttribute("d");u.push(["d",function(t){var e=t.path,r=t.localCTM;try{for(var n=he(e),a="",o=" ",i=[],s=!0,c=0,l=n.length;c<l;c++){var u=n[c],h=u.values,f=u.key,v=u.relative;switch(f){case"A":for(var d=[],y=0,p=h.length;y<p;y+=7){var b=ie(h.slice(y,y+7),7),x=b[0],m=b[1],g=b[2],w=b[3],_=b[4],k=b[5],M=b[6],j=ue(r);v&&(j.e=j.f=0);var E=le(j,k,M),S=E.x,A=E.y;d.push(ce(S),ce(A)),j.e=j.f=0;var T=le(j,x,m),O=T.x,V=T.y;d.unshift(ce(O),ce(V),g,w,_)}i.push(d);break;case"C":for(var z=[],C=0,D=h.length;C<D;C+=6){var R=ie(h.slice(C,C+6),6),X=R[0],Y=R[1],P=R[2],N=R[3],F=R[4],B=R[5],L=ue(r);v&&(L.e=L.f=0);var H=le(L,X,Y),W=H.x,I=H.y,q=le(L,P,N),U=q.x,G=q.y,Q=le(L,F,B),Z=Q.x,$=Q.y;z.push(ce(W),ce(I),ce(U),ce(G),ce(Z),ce($))}i.push(z);break;case"H":for(var J=[],K=0,tt=h.length;K<tt;K+=1){var et=ie(h.slice(K,K+1),1)[0],rt=ue(r);v&&(rt.e=rt.f=0);var nt=le(rt,et,0).x;J.push(ce(nt))}i.push(J);break;case"V":for(var at=[],ot=0,it=h.length;ot<it;ot+=1){var st=ie(h.slice(ot,ot+1),1)[0],ct=ue(r);v&&(ct.e=ct.f=0);var lt=le(ct,0,st).y;at.push(ce(lt))}i.push(at);break;case"T":case"L":for(var ut=[],ht=0,ft=h.length;ht<ft;ht+=2){var vt=ie(h.slice(ht,ht+2),2),dt=vt[0],yt=vt[1],pt=ue(r);v&&(pt.e=pt.f=0);var bt=le(pt,dt,yt),xt=bt.x,mt=bt.y;ut.push(ce(xt),ce(mt))}i.push(ut);break;case"M":for(var gt=[],wt=0,_t=h.length;wt<_t;wt+=2){var kt=ie(h.slice(wt,wt+2),2),Mt=kt[0],jt=kt[1],Et=ue(r);v&&!s&&(Et.e=Et.f=0);var St=le(Et,Mt,jt),At=St.x,Tt=St.y;gt.push(ce(At),ce(Tt)),s=!1}i.push(gt);break;case"Q":for(var Ot=[],Vt=0,zt=h.length;Vt<zt;Vt+=4){var Ct=ie(h.slice(Vt,Vt+4),4),Dt=Ct[0],Rt=Ct[1],Xt=Ct[2],Yt=Ct[3],Pt=ue(r);v&&(Pt.e=Pt.f=0);var Nt=le(Pt,Dt,Rt),Ft=Nt.x,Bt=Nt.y,Lt=le(Pt,Xt,Yt),Ht=Lt.x,Wt=Lt.y;Ot.push(ce(Ft),ce(Bt),ce(Ht),ce(Wt))}i.push(Ot);break;case"S":for(var It=[],qt=0,Ut=h.length;qt<Ut;qt+=4){var Gt=ie(h.slice(qt,qt+4),4),Qt=Gt[0],Zt=Gt[1],$t=Gt[2],Jt=Gt[3],Kt=ue(r);v&&(Kt.e=Kt.f=0);var te=le(Kt,Qt,Zt),ee=te.x,re=te.y,ne=le(Kt,$t,Jt),ae=ne.x,oe=ne.y;It.push(ce(ee),ce(re),ce(ae),ce(oe))}i.push(It);break;case"Z":i.push([""]),o=""}a+=u.cmd+i[c].join(",")+o}return a}catch(t){se("Path parsing error: "+t)}}({path:rt,localCTM:f})])}u.forEach(function(t){var e=ie(t,2),r=e[0],n=e[1];a.setAttribute(r,n)})},et=function(t,e,r){var n=e.rotatable,a=e.rotatorAnchor,o=e.rotatorOffset,i=t.box,s=t.handles,c=t.center,l=r.x,u=r.y,h=r.width,f=r.height,v=r.boxMatrix,d=h/2,y=f/2,p=null!==v?v:st(i,i.parentNode),b=le(p,l+d,u+y),x={tl:le(p,l,u),tr:le(p,l+h,u),br:le(p,l+h,u+f),bl:le(p,l,u+f),tc:le(p,l+d,u),bc:le(p,l+d,u+f),ml:le(p,l,u+y),mr:le(p,l+h,u+y),center:mt(s.center)&&!c.isShifted?b:void 0};if(n){var m={},g=1;switch(a){case"n":m.x=x.tc.x,m.y=x.tc.y;break;case"s":m.x=x.bc.x,m.y=x.bc.y,g=-1;break;case"w":m.x=x.ml.x,m.y=x.ml.y,g=-1;break;case"e":default:m.x=x.mr.x,m.y=x.mr.y}var w="n"===a||"s"===a?Math.atan2(x.bl.y-x.tl.y,x.bl.x-x.tl.x):Math.atan2(x.tl.y-x.tr.y,x.tl.x-x.tr.x),_={x:m.x-o*g*Math.cos(w),y:m.y-o*g*Math.sin(w)},k=s.normal,M=s.radius;mt(k)&&(k.x1.baseVal.value=m.x,k.y1.baseVal.value=m.y,k.x2.baseVal.value=_.x,k.y2.baseVal.value=_.y),mt(M)&&(M.x1.baseVal.value=b.x,M.y1.baseVal.value=b.y,c.isShifted||(M.x2.baseVal.value=b.x,M.y2.baseVal.value=b.y)),x.rotator=_}var j={x:l+=h<0?h:0,y:u+=f<0?f:0,width:Math.abs(h),height:Math.abs(f)};Object.keys(j).forEach(function(t){i.setAttribute(t,j[t])}),Object.keys(x).forEach(function(t){var e=s[t],r=x[t];bt(r)||bt(e)||("g"===e.tagName||"path"===e.tagName?e.instance&&"path"===e.tagName?e.instance.transform({x:r.x,y:r.y}):e.setAttribute("transform","matrix(1, 0, 0, 1, ".concat(r.x,", ").concat(r.y,")")):(e.setAttribute("cx",r.x),e.setAttribute("cy",r.y)))})},rt=function(t,e,r,n){var a=G("circle");wt(a,"sjx-svg-hdl-".concat(n));var o={cx:t,cy:e,r:5.5,fill:r,stroke:"#fff","fill-opacity":1,"vector-effect":"non-scaling-stroke","stroke-width":1};return Object.keys(o).map(function(t){a.setAttribute(t,o[t])}),a},lt=function(t,e){t.setAttribute("stroke",e),t.setAttribute("stroke-dasharray","3 3"),t.setAttribute("vector-effect","non-scaling-stroke")};function ut(r,t){if(this.length){var n=mt(t)&&t instanceof m?t:new m;return y.call(this,function(t,e){return e instanceof SVGElement?function(t){var e=t.tagName.toLowerCase();return-1!==q.indexOf(e)||(se("Selected element "+e+" is not allowed to transform. Allowed elements:\n"+"circle, ellipse, image, line, path, polygon, polyline, rect, text, g, foreignObject"),!1)}(e)&&t.push(new $(e,r,n)):t.push(new P(e,r,n)),t},[])}}var ht=function(){s(a,_);var n=l(a);function a(t,e){var r;return i(this,a),(r=n.call(this,t)).enable(e),r}return r(a,[{key:"_init",value:function(){var e=this,t=this.el,r=this.options,n=gt(t),a=r.style,o=r.appendTo,i=at({position:"absolute","z-index":"2147483647"},a);this.storage={css:i,parent:mt(o)?gt(o)[0]:document.body},n.on("mousedown",this._onMouseDown).on("touchstart",this._onTouchStart),j.slice(0,3).forEach(function(t){e.eventDispatcher.registerEvent(t)})}},{key:"_processOptions",value:function(t){var e={},r=null,n=document,a=function(){},o=function(){},i=function(){},s=function(){};if(mt(t)){var c=t.style,l=t.appendTo,u=t.stack,h=t.onInit,f=t.onMove,v=t.onDrop,d=t.onDestroy;e=mt(c)&&"object"===pt(c)?c:e,r=l||null;var y=mt(u)?gt(u)[0]:document;a=xt(h),o=xt(f),i=U(v)?function(t){var e=this.storage.clone;!function(t,e){var r=H(t),n=r.top,a=r.left,o=H(e),i=o.top,s=o.left,c=gt(t),l=gt(e);return!(n<i||n+parseFloat(c.css("height"))>i+parseFloat(l.css("height"))||a<s||a+parseFloat(c.css("width"))>s+parseFloat(l.css("width")))}(e,y)||v.call(this,t,this.el,e)}:function(){},s=xt(d)}this.options={style:e,appendTo:r,stack:n},this.proxyMethods={onInit:a,onDrop:i,onMove:o,onDestroy:s}}},{key:"_start",value:function(t){var e=t.clientX,r=t.clientY,n=this.storage,a=this.el,o=n.parent,i=n.css,s=H(o),c=s.left,l=s.top;i.left="".concat(e-c,"px"),i.top="".concat(r-l,"px");var u=a.cloneNode(!0);gt(u).css(i),n.clientX=e,n.clientY=r,n.cx=e,n.cy=r,n.clone=u,gt(o)[0].appendChild(u),this._draw()}},{key:"_moving",value:function(t){var e=t.clientX,r=t.clientY,n=this.storage;n.clientX=e,n.clientY=r,n.doDraw=!0,n.doMove=!0}},{key:"_end",value:function(t){var e=this.storage,r=e.clone,n=e.frameId;e.doDraw=!1,x(n),bt(r)||(this.proxyMethods.onDrop.call(this,t),r.parentNode.removeChild(r),delete e.clone)}},{key:"_animate",value:function(){var t=this.storage;t.frameId=ot(this._animate);var e=t.doDraw,r=t.clientX,n=t.clientY,a=t.cx,o=t.cy;e&&(t.doDraw=!1,this._drag({dx:r-a,dy:n-o}))}},{key:"_processMove",value:function(t,e){var r=this.storage.clone,n="translate(".concat(t,"px, ").concat(e,"px)");gt(r).css({transform:n,webkitTranform:n,mozTransform:n,msTransform:n,otransform:n})}},{key:"_destroy",value:function(){var t=this.storage,e=this.proxyMethods,r=this.el;bt(t)||(gt(r).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart),e.onDestroy.call(this,r),delete this.storage)}},{key:"disable",value:function(){this._destroy()}}]),a}();function ft(e){if(this.length)return d.call(this,function(t){return new ht(t,e)})}var vt=function(){s(e,p);var t=l(e);function e(){return i(this,e),t.apply(this,arguments)}return r(e,[{key:"drag",value:function(){return ut.call.apply(ut,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"clone",value:function(){return ft.call.apply(ft,[this].concat(Array.prototype.slice.call(arguments)))}}]),e}();function dt(t){return new vt(t)}return Object.defineProperty(dt,"createObservable",{value:function(){return new m}}),Object.defineProperty(dt,"Subjx",{value:vt}),Object.defineProperty(dt,"Observable",{value:m}),dt});
