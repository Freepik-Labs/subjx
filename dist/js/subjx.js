/*@license
* Drag/Rotate/Resize Library
* Released under the MIT license, 2018-2020
* Karen Sarksyan
* nichollascarter@gmail.com
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).subjx=e()}(this,function(){"use strict";function ut(t){return(ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function c(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}function e(e,t){var r,n=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)),n}function V(n){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?e(Object(o),!0).forEach(function(t){var e,r;e=n,t=o[r=t],r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(o,t))})}return n}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function r(t,e){return(r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t,e){if(null==t)return{};var r,n=function(t,e){if(null==t)return{};for(var r,n={},o=Object.keys(t),a=0;a<o.length;a++)r=o[a],0<=e.indexOf(r)||(n[r]=t[r]);return n}(t,e);if(Object.getOwnPropertySymbols)for(var o=Object.getOwnPropertySymbols(t),a=0;a<o.length;a++)r=o[a],0<=e.indexOf(r)||Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r]);return n}function a(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=o(r);return a(this,n?(t=o(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function mt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var s,i=t[Symbol.iterator]();!(n=(s=i.next()).done)&&(r.push(s.value),!e||r.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==i["return"]||i["return"]()}finally{if(o)throw a}}return r}(t,e)||h(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(t){return function(t){if(Array.isArray(t))return f(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||h(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){if(t){if("string"==typeof t)return f(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(t,e):void 0}}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function ht(t){return null==t}function z(t){return"function"==typeof t}function ft(t){return z(t)?function(){t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}:function(){}}var A=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},v=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(t){clearTimeout(t)},t=Array.prototype,y=t.forEach,d=t.slice,p=t.map,b=t.reduce,gt=console.warn,vt=function(t){return null!=t},x=function(){function s(t){if(i(this,s),"string"==typeof t){var e=document.querySelectorAll(t);this.length=e.length;for(var r=0;r<this.length;r++)this[r]=e[r]}else if("object"!==ut(t)||1!==t.nodeType&&t!==document)if(t instanceof s){this.length=t.length;for(var n=0;n<this.length;n++)this[n]=t[n]}else{if(!vt(a=t)||"object"!==ut(a)||!(Array.isArray(a)||vt(window.Symbol)&&"function"==typeof a[window.Symbol.iterator]||vt(a.forEach)||"number"==typeof a.length&&(0===a.length||0<a.length&&a.length-1 in a)))throw new Error("Passed parameter must be selector/element/elementArray");for(var o=this.length=0;o<this.length;o++)1===t.nodeType&&(this[o]=t[o],this.length++)}else this[0]=t,this.length=1;var a}return c(s,[{key:"css",value:function(r){var t={setStyle:function(t){return function(t,e){for(var r=t.length;r--;)for(var n in e)t[r].style[n]=e[n];return t.style}(this,t)},getStyle:function(){return function(t){var e=t.length;if(e--)return(t[e].currentStyle||(document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t[e],""):t[e].style))[r]}(this)}};return"string"==typeof r?t.getStyle.apply(this,d.call(arguments,1)):"object"!==ut(r)&&r?(gt("Method ".concat(r," does not exist")),!1):t.setStyle.apply(this,arguments)}},{key:"on",value:function(){for(var t=this.length;t--;)this[t].events||(this[t].events={},this[t].events[arguments[0]]=[]),"string"!=typeof arguments[1]?document.addEventListener?this[t].addEventListener(arguments[0],arguments[1],arguments[2]||{passive:!1}):document.attachEvent?this[t].attachEvent("on".concat(arguments[0]),arguments[1]):this[t]["on".concat(arguments[0])]=arguments[1]:m(this[t],arguments[0],arguments[1],arguments[2],arguments[3],!0);return this}},{key:"off",value:function(){for(var t=this.length;t--;)this[t].events||(this[t].events={},this[t].events[arguments[0]]=[]),"string"!=typeof arguments[1]?document.removeEventListener?this[t].removeEventListener(arguments[0],arguments[1],arguments[2]):document.detachEvent?this[t].detachEvent("on".concat(arguments[0]),arguments[1]):this[t]["on".concat(arguments[0])]=null:m(this[t],arguments[0],arguments[1],arguments[2],arguments[3],!1);return this}},{key:"is",value:function(t){if(ht(t))return!1;for(var e=yt(t),r=this.length;r--;)if(this[r]===e[r])return!0;return!1}}]),s}();function m(t,e,r,n,o,a){function s(t){for(var e=t.target;e&&e!==this;)e.matches(r)&&n.call(e,t),e=e.parentNode}!0===a?document.addEventListener?t.addEventListener(e,s,o||{passive:!1}):document.attachEvent?t.attachEvent("on".concat(e),s):t["on".concat(e)]=s:document.removeEventListener?t.removeEventListener(e,s,o||{passive:!1}):document.detachEvent?t.detachEvent("on".concat(e),s):t["on".concat(e)]=null}function yt(t){return new x(t)}function T(t,e){if(0===e)return t;var r=R(t,e);return r-t<e?r:void 0}function _t(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:6;return Number(t.toFixed(e))}function j(t){return t.getBoundingClientRect()}function g(t){return t.css("-webkit-transform")||t.css("-moz-transform")||t.css("-ms-transform")||t.css("-o-transform")||t.css("transform")||"none"}function _(t){return(t=t.match(/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g))?t.map(function(t){return parseFloat(t)}):[1,0,0,1,0,0]}function dt(e,t){if(t){if(e.classList){if(!(-1<t.indexOf(" ")))return e.classList.add(t);t.split(/\s+/).forEach(function(t){return e.classList.add(t)})}return e}}function E(e,t){if(t){if(e.classList){if(!(-1<t.indexOf(" ")))return e.classList.remove(t);t.split(/\s+/).forEach(function(t){return e.classList.remove(t)})}return e}}function k(t){return{transform:t="matrix(".concat(t.join(),")"),webkitTranform:t,mozTransform:t,msTransform:t,otransform:t}}var w=function(){function t(){i(this,t),this.observers={}}return c(t,[{key:"subscribe",value:function(t,e){var r=this.observers;return ht(r[t])&&Object.defineProperty(r,t,{value:[]}),r[t].push(e),this}},{key:"unsubscribe",value:function(t,e){var r=this.observers;return vt(r[t])&&(e=r[t].indexOf(e),r[t].splice(e,1)),this}},{key:"notify",value:function(e,r,n){ht(this.observers[e])||this.observers[e].forEach(function(t){if(r!==t)switch(e){case"onmove":t.notifyMove(n);break;case"onrotate":t.notifyRotate(n);break;case"onresize":t.notifyResize(n);break;case"onapply":t.notifyApply(n);break;case"ongetstate":t.notifyGetState(n)}})}}]),t}(),M=function(){function e(t){i(this,e),this.name=t,this.callbacks=[]}return c(e,[{key:"registerCallback",value:function(t){this.callbacks.push(t)}},{key:"removeCallback",value:function(t){t=this.callbacks(t);this.callbacks.splice(t,1)}}]),e}(),S=function(){function t(){i(this,t),this.events={}}return c(t,[{key:"registerEvent",value:function(t){this.events[t]=new M(t)}},{key:"emit",value:function(e,t,r){this.events[t].callbacks.forEach(function(t){t.call(e,r)})}},{key:"addEventListener",value:function(t,e){this.events[t].registerCallback(e)}},{key:"removeEventListener",value:function(t,e){this.events[t].removeCallback(e)}}]),t}(),O=function(){function e(t){i(this,e),this.el=t,this.storage=null,this.proxyMethods=null,this.eventDispatcher=new S,this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._animate=this._animate.bind(this)}return c(e,[{key:"enable",value:function(t){this._processOptions(t),this._init(this.el),this.proxyMethods.onInit.call(this,this.el)}},{key:"disable",value:function(){C()}},{key:"_init",value:function(){C()}},{key:"_destroy",value:function(){C()}},{key:"_processOptions",value:function(){C()}},{key:"_start",value:function(){C()}},{key:"_moving",value:function(){C()}},{key:"_end",value:function(){C()}},{key:"_animate",value:function(){C()}},{key:"_drag",value:function(t){var e=t.dx,r=t.dy,t=l(t,["dx","dy"]),t=V({dx:e,dy:r,transform:this._processMove(e,r)},t);this.proxyMethods.onMove.call(this,t),this._emitEvent("drag",t)}},{key:"_draw",value:function(){this._animate()}},{key:"_onMouseDown",value:function(t){this._start(t),yt(document).on("mousemove",this._onMouseMove).on("mouseup",this._onMouseUp)}},{key:"_onTouchStart",value:function(t){this._start(t.touches[0]),yt(document).on("touchmove",this._onTouchMove).on("touchend",this._onTouchEnd)}},{key:"_onMouseMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t,this.el)}},{key:"_onTouchMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t.touches[0],this.el)}},{key:"_onMouseUp",value:function(t){yt(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp),this._end(t,this.el)}},{key:"_onTouchEnd",value:function(t){yt(document).off("touchmove",this._onTouchMove).off("touchend",this._onTouchEnd),0===t.touches.length&&this._end(t.changedTouches[0],this.el)}},{key:"_emitEvent",value:function(){var t;(t=this.eventDispatcher).emit.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"on",value:function(t,e){return this.eventDispatcher.addEventListener(t,e),this}},{key:"off",value:function(t,e){return this.eventDispatcher.removeEventListener(t,e),this}}]),e}(),C=function(){throw Error("Method not implemented")},D=["dragStart","drag","dragEnd","resizeStart","resize","resizeEnd","rotateStart","rotate","rotateEnd","setPointStart","setPointEnd"],pt=Math.PI/180,R=function(t,e){return 0===e?t:Math.round(t/e)*e},X=P("svg").createSVGPoint(),Y=/[+-]?\d+(\.\d+)?/g,N=["circle","ellipse","image","line","path","polygon","polyline","rect","text","g","foreignobject"];function P(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function B(t){var r=[];return Z(t)?y.call(t.childNodes,function(t){var e;1===t.nodeType&&(e=t.tagName.toLowerCase(),-1!==N.indexOf(e)&&("g"===e&&r.push.apply(r,L(B(t))),r.push(t)))}):r.push(t),r}function F(){return P("svg").createSVGMatrix()}function H(t,e){return(e.getScreenCTM()||F()).inverse().multiply(t.getScreenCTM()||F())}function W(t){var e=t.a,r=t.b,n=t.c,o=t.d,a=t.e,t=t.f;return"matrix(".concat(e,",").concat(r,",").concat(n,",").concat(o,",").concat(a,",").concat(t,")")}function kt(t,e,r){return X.x=e,X.y=r,X.matrixTransform(t)}function wt(t){var e=F();return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f,e}function I(t){return t.match(Y).reduce(function(t,e,r,n){return r%2==0&&t.push(n.slice(r,r+2)),t},[])}function q(t,e){var r=t.x,n=t.y,o=mt(e,6),a=o[0],s=o[1],t=o[2],e=o[3];return{x:a*r+t*n+o[4],y:s*r+e*n+o[5]}}function U(t){var e=[[t[0],t[2],t[4]],[t[1],t[3],t[5]],[0,0,1]];if(e.length===e[0].length){for(var r=e.length,n=[],o=[],a=0;a<r;a+=1){n[n.length]=[],o[o.length]=[];for(var s=0;s<r;s+=1)n[a][s]=a==s?1:0,o[a][s]=e[a][s]}for(var i=0;i<r;i+=1){var c=o[i][i];if(0===c){for(var l=i+1;l<r;l+=1)if(0!==o[l][i]){for(var u=0;u<r;u++)c=o[i][u],o[i][u]=o[l][u],o[l][u]=c,c=n[i][u],n[i][u]=n[l][u],n[l][u]=c;break}if(0===(c=o[i][i]))return}for(var h=0;h<r;h++)o[i][h]=o[i][h]/c,n[i][h]=n[i][h]/c;for(var f=0;f<r;f++)if(f!=i){c=o[f][i];for(var v=0;v<r;v++)o[f][v]-=c*o[i][v],n[f][v]-=c*n[i][v]}}return[n[0][0],n[1][0],n[0][1],n[1][1],n[0][2],n[1][2]]}}function G(t,e){for(var r=(u=mt(t,6))[0],n=u[1],o=u[2],a=u[3],s=u[4],i=u[5],c=mt(e,6),l=c[0],t=c[1],u=c[2],e=c[3],h=[[r,o,s],[n,a,i],[0,0,1]],f=[[l,u,c[4]],[t,e,c[5]],[0,0,1]],v=[],y=0;y<f.length;y++){v[y]=[];for(var d=0;d<h[0].length;d++){for(var p=0,b=0;b<h.length;b++)p+=h[b][d]*f[y][b];v[y].push(p)}}return[v[0][0],v[1][0],v[0][1],v[1][1],v[0][2],v[1][2]]}function Q(t,e,r,n,o,a,s,i,c){var l=parseFloat(r)/2,u=parseFloat(n)/2,t=t-(r=t+l),e=e-(n=e+u),o=Math.atan2(i?0:e,c?0:t)+o,i=Math.sqrt(Math.pow(c?0:l,2)+Math.pow(i?0:u,2)),u=Math.cos(o),o=Math.sin(o),o=n+i*(o=!0===s?-o:o);return{left:_t(r+i*(u=!0===a?-u:u)),top:_t(o)}}function Mt(t){for(var e=rt.lastIndex=0,r=[];e=rt.exec(t);){var n=e[1],o=n.toUpperCase(),a=e[2].replace(/([^e])-/g,"$1 -").replace(/ +/g," ");r.push({relative:n!==o,key:o,cmd:n,values:a.trim().split(nt).map(function(t){if(!isNaN(t))return Number(t)})})}return r}var Z=function(t){return"g"===t.tagName.toLowerCase()},$=function(){s(a,O);var o=u(a);function a(t,e,r){var n;if(i(this,a),(n=o.call(this,t)).constructor===a)throw new TypeError("Cannot construct Transformable instances directly");return n.observable=r,D.forEach(function(t){n.eventDispatcher.registerEvent(t)}),n.enable(e),n}return c(a,[{key:"_cursorPoint",value:function(){throw Error("'_cursorPoint()' method not implemented")}},{key:"_rotate",value:function(t){var e=t.radians,t=l(t,["radians"]),t=V({transform:this._processRotate(e),delta:e},t);this.proxyMethods.onRotate.call(this,t),this._emitEvent("rotate",t)}},{key:"_resize",value:function(t){var e=t.dx,r=t.dy,t=l(t,["dx","dy"]),t=V(V({},this._processResize(e,r)),{},{dx:e,dy:r},t);this.proxyMethods.onResize.call(this,t),this._emitEvent("resize",t)}},{key:"_processOptions",value:function(t){var e=this.el;dt(e,"sjx-drag");var r,n,o,a,s,i,c,l,u,h,f,v,y,d,p,b,x,m,g,_,k,w,M,j,E,S,A,T,O,V,z,C,D={x:10,y:10,angle:10*pt},R={move:!1,resize:!1,rotate:!1},X=null,Y=!1,N=!1,P="xy",B=!1,L=5,F=!0,H=!1,W=!1,I=!1,q="auto",U="auto",G="auto",Q=!1,Z=!0,$=!0,J=!0,K=null,tt=50,et=!0,rt=null,nt=function(){},ot=function(){},at=function(){},st=function(){},it=function(){},ct=function(){},lt=e.parentNode;vt(t)&&(r=t.snap,C=t.each,n=t.axis,o=t.cursorMove,a=t.cursorResize,s=t.cursorRotate,i=t.rotationPoint,c=t.restrict,l=t.draggable,u=t.resizable,h=t.rotatable,f=t.onInit,v=t.onDrop,y=t.onMove,d=t.onResize,p=t.onRotate,b=t.onDestroy,x=t.container,m=t.proportions,g=t.keepTransformations,_=t.custom,k=t.rotatorAnchor,w=t.rotatorOffset,M=t.showNormal,j=t.withoutScaling,E=t.minSize,S=t.allowReversing,A=t.minStartDistance,T=t.processMove,O=t.processResize,vt(r)&&(t=r.x,V=r.y,z=r.angle,D.x=ht(t)?10:t,D.y=ht(V)?10:V,D.angle=ht(z)?D.angle:z*pt),vt(C)&&(V=C.move,z=C.resize,C=C.rotate,R.move=V||!1,R.resize=z||!1,R.rotate=C||!1),vt(c)&&(X="parent"===c?e.parentNode:yt(c)[0]||document),q=o||"auto",U=a||"auto",G=s||"auto",P=n||"xy",lt=vt(x)&&yt(x)[0]?yt(x)[0]:lt,Q=i||!1,Y=m||!1,N="boolean"==typeof g?g:["g","svg","rect","foreignobject"].includes(e.tagName.toLowerCase()),B=j||!1,L=E||5,F=S||!0,I=A||!1,H=T||!1,W=O||!1,Z=!vt(l)||l,$=!vt(u)||u,J=!vt(h)||h,rt="object"===ut(_)&&_||null,K=k||null,tt=w||50,et=!vt(M)||M,nt=ft(f),it=ft(v),ot=ft(y),st=ft(d),at=ft(p),ct=ft(b)),this.options={axis:P,cursorMove:q,cursorRotate:G,cursorResize:U,rotationPoint:Q,restrict:X,container:lt,snap:D,each:R,proportions:Y,keepTransformations:N,draggable:Z,resizable:$,rotatable:J,custom:rt,rotatorAnchor:K,rotatorOffset:tt,showNormal:et,withoutScaling:B,minSize:L,allowReversing:F,minStartDistance:I,processMove:H,processResize:W},this.proxyMethods={onInit:nt,onDrop:it,onMove:ot,onResize:st,onRotate:at,onDestroy:ct},this.subscribe(R)}},{key:"_animate",value:function(){var t,e,r,n,o,a,s,i,c,l,u,h,f,v,y,d,p,b,x,m,g,_,k,w,M=this,j=M.observable,E=M.storage,S=M.options;ht(E)||(E.frame=A(M._animate),E.doDraw&&(E.doDraw=!1,t=E.dox,e=E.doy,w=E.clientX,k=E.clientY,y=E.doDrag,r=E.doResize,g=E.doRotate,n=E.doSetCenter,u=E.revX,f=E.revY,o=S.snap,a=(c=S.each).move,m=c.resize,s=c.rotate,i=S.restrict,d=S.draggable,c=S.resizable,S=S.rotatable,r&&c&&(l=E.transform,b=E.cx,x=E.cy,v=(h=this._pointToElement({x:w,y:k})).x,p=h.y,h=t?T(v-b,o.x/l.scX):0,v=e?T(p-x,o.y/l.scY):0,b={dx:h=t?u?-h:h:0,dy:v=e?f?-v:v:0,clientX:w,clientY:k},M._resize(b),m&&j.notify("onresize",M,b)),y&&d&&(p=E.restrictOffset,x=E.elementOffset,l=E.nx,_=E.ny,vt(i)&&(u=p.left,h=p.top,f=x.left,v=x.top,m=x.width,b=x.height,y=l-w,d=_-k,p=i.clientWidth-m,(x=v-h)-d<0&&(k=_-v+h),(m=f-u)-y<0&&(w=l-f+u),(b=i.clientHeight-b)<x-d&&(k=b+(_-v+h)),p<m-y&&(w=p+(l-f+u))),_={dx:t?T(w-l,o.x):0,dy:e?T(k-_,o.y):0,clientX:w,clientY:k},M._drag(_),a&&j.notify("onmove",M,_)),g&&S&&(_=E.pressang,g=E.center,g=Math.atan2(k-g.y,w-g.x)-_,_={clientX:w,clientY:k},M._rotate(V({radians:T(g,o.angle)},_)),s&&j.notify("onrotate",M,V({radians:g},_))),n&&S&&(S=E.bx,E=E.by,k=(w=this._pointToControls({x:w,y:k})).x,w=w.y,M._moveCenterHandle(k-S,w-E))))}},{key:"_start",value:function(t){var e=this.observable,r=this.storage,n=this.options,o=n.axis,a=n.restrict,s=n.each,i=this.el,c=this._compute(t);Object.keys(c).forEach(function(t){r[t]=c[t]});var l=c.onRightEdge,u=c.onBottomEdge,h=c.onTopEdge,f=c.onLeftEdge,v=c.handle,y=c.factor,d=c.revX,p=c.revY,b=c.doW,x=c.doH,m=l||u||h||f,g=r.handles,_=g.rotator,k=g.center,w=g.radius;vt(w)&&E(w,"sjx-hidden");var M=v.is(_)||_&&v.is(_.firstElementChild),n=!!vt(k)&&v.is(k),l=!(M||m||n),u=t.clientX,h=t.clientY,f=this._cursorPoint({clientX:u,clientY:h}),w=f.x,_=f.y,k=this._pointToElement({x:w,y:_}),t=k.x,f=k.y,k=this._pointToControls({x:w,y:_}),o={clientX:u,clientY:h,nx:w,ny:_,cx:t,cy:f,bx:k.x,by:k.y,doResize:m,doDrag:l,doRotate:M,doSetCenter:n,onExecution:!0,cursor:null,elementOffset:j(i),restrictOffset:vt(a)?j(a):null,dox:/\x/.test(o)&&(!m||(v.is(g.ml)||v.is(g.mr)||v.is(g.tl)||v.is(g.tr)||v.is(g.bl)||v.is(g.br))),doy:/\y/.test(o)&&(!m||(v.is(g.br)||v.is(g.bl)||v.is(g.bc)||v.is(g.tr)||v.is(g.tl)||v.is(g.tc)))};this.storage=V(V({},r),o);v={clientX:u,clientY:h};m?this._emitEvent("resizeStart",v):M?this._emitEvent("rotateStart",v):l&&this._emitEvent("dragStart",v);g=s.move,o=s.resize,v=s.rotate,s=m?"resize":M?"rotate":"drag",g=m&&o||M&&v||l&&g;e.notify("ongetstate",this,{clientX:u,clientY:h,actionName:s,triggerEvent:g,factor:y,revX:d,revY:p,doW:b,doH:x}),this._draw()}},{key:"_moving",value:function(t){var e=this.storage,r=this.options,n=this._cursorPoint(t),o=n.x,a=n.y;e.e=t,e.clientX=o,e.clientY=a,e.doDraw=!0;var s=e.doRotate,n=e.doDrag,t=e.doResize,o=e.cursor,a=r.cursorMove,e=r.cursorResize,r=r.cursorRotate;ht(o)&&(n?o=a:s?o=r:t&&(o=e),yt(document.body).css({cursor:o}))}},{key:"_end",value:function(t){var e=t.clientX,r=t.clientY,n=this.options.each,o=this.observable,a=this.storage,s=this.proxyMethods,i=a.doResize,c=a.doDrag,l=a.doRotate,u=a.frame,h=a.handles.radius,f=i?"resize":c?"drag":"rotate";a.doResize=!1,a.doDrag=!1,a.doRotate=!1,a.doSetCenter=!1,a.doDraw=!1,a.onExecution=!1,a.cursor=null,this._apply(f);t={clientX:e,clientY:r};s.onDrop.call(this,t),i?this._emitEvent("resizeEnd",t):l?this._emitEvent("rotateEnd",t):c&&this._emitEvent("dragEnd",t),a.outOfSnap=!1;t=n.move,a=n.resize,n=n.rotate,t=i&&a||l&&n||c&&t;o.notify("onapply",this,{clientX:e,clientY:r,actionName:f,triggerEvent:t}),v(u),yt(document.body).css({cursor:"auto"}),vt(h)&&dt(h,"sjx-hidden")}},{key:"_compute",value:function(t){var e=this.storage.handles,r=yt(t.target),n=this._checkHandles(r,e),o=n.revX,a=n.revY,s=n.doW,e=n.doH,n=l(n,["revX","revY","doW","doH"]),s=this._getState({revX:o,revY:a,doW:s,doH:e}),e=this._cursorPoint(t),t=e.x,e=e.y,t=Math.atan2(e-s.center.y,t-s.center.x);return V(V(V({},s),n),{},{handle:r,pressang:t})}},{key:"_checkHandles",value:function(t,e){var r=e.tl,n=e.tc,o=e.tr,a=e.bl,s=e.br,i=e.bc,c=e.ml,e=e.mr,r=!!vt(r)&&t.is(r),n=!!vt(n)&&t.is(n),o=!!vt(o)&&t.is(o),a=!!vt(a)&&t.is(a),i=!!vt(i)&&t.is(i),s=!!vt(s)&&t.is(s),c=!!vt(c)&&t.is(c),e=!!vt(e)&&t.is(e);return{revX:r||c||a||n,revY:r||o||n||c,onTopEdge:n||o||r,onLeftEdge:r||c||a,onRightEdge:o||e||s,onBottomEdge:s||i||a,doW:c||e,doH:n||i}}},{key:"notifyMove",value:function(){this._drag.apply(this,arguments)}},{key:"notifyRotate",value:function(t){var e=t.radians,r=l(t,["radians"]),t=this.options.snap.angle;this._rotate(V({radians:T(e,t)},r))}},{key:"notifyResize",value:function(){this._resize.apply(this,arguments)}},{key:"notifyApply",value:function(t){var e=t.clientX,r=t.clientY,n=t.actionName,t=t.triggerEvent;this.proxyMethods.onDrop.call(this,{clientX:e,clientY:r}),t&&(this._apply(n),this._emitEvent("".concat(n,"End"),{clientX:e,clientY:r}))}},{key:"notifyGetState",value:function(t){var e=t.clientX,r=t.clientY,n=t.actionName,o=t.triggerEvent,t=l(t,["clientX","clientY","actionName","triggerEvent"]);o&&(t=this._getState(t),this.storage=V(V({},this.storage),t),this._emitEvent("".concat(n,"Start"),{clientX:e,clientY:r}))}},{key:"subscribe",value:function(t){var e=t.resize,r=t.move,n=t.rotate,t=this.observable;(r||e||n)&&t.subscribe("ongetstate",this).subscribe("onapply",this),r&&t.subscribe("onmove",this),e&&t.subscribe("onresize",this),n&&t.subscribe("onrotate",this)}},{key:"unsubscribe",value:function(){this.observable.unsubscribe("ongetstate",this).unsubscribe("onapply",this).unsubscribe("onmove",this).unsubscribe("onresize",this).unsubscribe("onrotate",this)}},{key:"disable",value:function(t,e){var r=this.storage,n=this.proxyMethods,o=this.el;ht(r)||(r.onExecution&&(this._end({clientX:t,clientY:e}),yt(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp).off("touchmove",this._onTouchMove).off("touchend",this._onTouchEnd)),E(o,"sjx-drag"),this._destroy(),this.unsubscribe(),n.onDestroy.call(this,o),delete this.storage)}},{key:"exeDrag",value:function(t){var e=t.dx,t=t.dy;this.options.draggable&&(this.storage=V(V({},this.storage),this._getState({revX:!1,revY:!1,doW:!1,doH:!1})),this._drag({dx:e,dy:t}),this._apply("drag"))}},{key:"exeResize",value:function(t){var e=t.dx,r=t.dy,n=t.revX,o=t.revY,a=t.doW,t=t.doH;this.options.resizable&&(this.storage=V(V({},this.storage),this._getState({revX:n||!1,revY:o||!1,doW:a||!1,doH:t||!1})),this._resize({dx:e,dy:r}),this._apply("resize"))}},{key:"exeRotate",value:function(t){t=t.delta;this.options.rotatable&&(this.storage=V(V({},this.storage),this._getState({revX:!1,revY:!1,doW:!1,doH:!1})),this._rotate({radians:t}),this._apply("rotate"))}}]),a}(),J=2,K=7,tt=function(){s(e,$);var t=u(e);function e(){return i(this,e),t.apply(this,arguments)}return c(e,[{key:"_init",value:function(t){var e=this.options,r=e.rotationPoint,n=e.container,o=e.resizable,a=e.rotatable,s=e.showNormal,i=t.style,c=i.left,l=i.top,u=i.width,e=i.height,i=document.createElement("div");dt(i,"sjx-wrapper"),n.appendChild(i);var n=yt(t),u=u||n.css("width"),e=e||n.css("height"),n={top:l||n.css("top"),left:c||n.css("left"),width:u,height:e,transform:g(n)},h=document.createElement("div");dt(h,"sjx-controls");var f=V(V(V({},a&&{normal:s?["sjx-normal"]:null,rotator:["sjx-hdl","sjx-hdl-m","sjx-rotator"]}),o&&{tl:["sjx-hdl","sjx-hdl-t","sjx-hdl-l","sjx-hdl-tl"],tr:["sjx-hdl","sjx-hdl-t","sjx-hdl-r","sjx-hdl-tr"],br:["sjx-hdl","sjx-hdl-b","sjx-hdl-r","sjx-hdl-br"],bl:["sjx-hdl","sjx-hdl-b","sjx-hdl-l","sjx-hdl-bl"],tc:["sjx-hdl","sjx-hdl-t","sjx-hdl-c","sjx-hdl-tc"],bc:["sjx-hdl","sjx-hdl-b","sjx-hdl-c","sjx-hdl-bc"],ml:["sjx-hdl","sjx-hdl-m","sjx-hdl-l","sjx-hdl-ml"],mr:["sjx-hdl","sjx-hdl-m","sjx-hdl-r","sjx-hdl-mr"]}),{},{center:r&&a?["sjx-hdl","sjx-hdl-m","sjx-hdl-c","sjx-hdl-mc"]:void 0});Object.keys(f).forEach(function(t){var e=f[t];ht(e)||(e=et(e),f[t]=e,h.appendChild(e))}),vt(f.center)&&yt(f.center).css({left:"".concat(t.getAttribute("data-cx"),"px"),top:"".concat(t.getAttribute("data-cy"),"px")}),i.appendChild(h);i=yt(h);i.css(n),this.storage={controls:h,handles:f,radius:void 0,parent:t.parentNode},i.on("mousedown",this._onMouseDown).on("touchstart",this._onTouchStart)}},{key:"_destroy",value:function(){var t=this.storage.controls;yt(t).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart);t=t.parentNode;t.parentNode.removeChild(t)}},{key:"_pointToElement",value:function(t){var e=t.x,r=t.y,t=L(this.storage.transform.matrix);return t[4]=t[5]=0,this._applyMatrixToPoint(U(t),e,r)}},{key:"_pointToControls",value:function(t){return this._pointToElement(t)}},{key:"_applyMatrixToPoint",value:function(t,e,r){return q({x:e,y:r},t)}},{key:"_cursorPoint",value:function(t){var e=t.clientX,r=t.clientY,t=this.options.container,t=_(g(yt(t)));return q({x:e,y:r},U(t))}},{key:"_apply",value:function(){var t=this.el,e=this.storage,r=e.controls,n=e.handles,o=yt(r),e=parseFloat(o.css("width"))/2,r=parseFloat(o.css("height"))/2,o=n.center,n=vt(o),e=n?parseFloat(yt(o).css("left")):e,r=n?parseFloat(yt(o).css("top")):r;t.setAttribute("data-cx",e),t.setAttribute("data-cy",r),this.storage.cached=null}},{key:"_processResize",value:function(t,e){var r=this.el,n=this.storage,o=this.options.proportions,a=n.controls,s=n.coords,i=n.cw,c=n.ch,l=n.transform,u=n.refang,h=n.revX,f=n.revY,v=n.doW,y=n.doH,d=v||!v&&!y?(i+t)/i:(c+e)/c,t=o?i*d:i+t,e=o?c*d:c+e;if(!(t<=J||e<=J)){l=L(l.matrix),v=Q(l[4],l[5],t,e,u,h,f,v,y),y=s.left-v.left,v=s.top-v.top;l[4]+=y,l[5]+=v;l=k(l);return l.width="".concat(t,"px"),l.height="".concat(e,"px"),yt(a).css(l),yt(r).css(l),n.cached={dx:y,dy:v},{width:t,height:e,ox:y,oy:v}}}},{key:"_processMove",value:function(t,e){var r=this.el,n=this.storage,o=n.controls,a=n.transform,s=a.matrix,a=L(a.parentMatrix);a[4]=a[5]=0;a=L(s);a[4]=s[4]+t,a[5]=s[5]+e;s=k(a);return yt(o).css(s),yt(r).css(s),n.cached={dx:t,dy:e},a}},{key:"_processRotate",value:function(t){var e=this.el,r=this.storage,n=r.controls,o=r.transform,a=r.center,s=o.matrix,r=o.parentMatrix,o=_t(Math.cos(t),4),t=_t(Math.sin(t),4),a=[1,0,0,1,a.cx,a.cy],o=[o,t,-t,o,0,0],r=L(r);r[4]=r[5]=0;r=G(U(r),G(o,r)),a=G(G(a,r),U(a)),a=G(a,s),s=k(a);return yt(n).css(s),yt(e).css(s),a}},{key:"_getState",value:function(t){var e=t.revX,r=t.revY,n=t.doW,o=t.doH,a=e!==r?-1:1,s=this.el,i=this.storage,c=i.handles,l=i.controls,u=i.parent,h=this.options.container,f=c.center,v=yt(l),y=_(g(yt(h))),d=_(g(yt(l))),p=_(g(yt(u))),t=Math.atan2(d[1],d[0])*a,i=u!==h?G(p,y):y,c={matrix:d,parentMatrix:i,scX:Math.sqrt(d[0]*d[0]+d[1]*d[1]),scY:Math.sqrt(d[2]*d[2]+d[3]*d[3])},l=parseFloat(v.css("width")),u=parseFloat(v.css("height")),h=Q(d[4],d[5],l,u,t,e,r,n,o),p=l/2,y=u/2,v=j(s),d=vt(f),s=d?parseFloat(yt(f).css("left")):p,f=d?parseFloat(yt(f).css("top")):y,d=d?K:0,i=q({x:v.left,y:v.top},U(i));return{transform:c,cw:l,ch:u,coords:h,center:{x:i.x+s-d,y:i.y+f-d,cx:-s+p-d,cy:-f+y-d,hx:s,hy:f},factor:a,refang:t,revX:e,revY:r,doW:n,doH:o}}},{key:"_moveCenterHandle",value:function(t,e){var r=this.storage,n=r.handles.center,o=r.center,r=o.hx,o=o.hy,t="".concat(r+t,"px"),e="".concat(o+e,"px");yt(n).css({left:t,top:e})}},{key:"resetCenterPoint",value:function(){yt(this.storage.handles.center).css({left:null,top:null})}},{key:"fitControlsToSize",value:function(){}},{key:"controls",get:function(){return this.storage.controls}}]),e}(),et=function(t){var e=document.createElement("div");return t.forEach(function(t){dt(e,t)}),e},rt=/\s*([achlmqstvz])([^achlmqstvz]*)\s*/gi,nt=/\s*,\s*|\s+/g,ot="#00a8ff",at=function(){s(e,$);var t=u(e);function e(){return i(this,e),t.apply(this,arguments)}return c(e,[{key:"_init",value:function(t){var e=this.options,r=e.rotationPoint,n=e.container,o=e.resizable,a=e.rotatable,s=e.rotatorAnchor,i=e.rotatorOffset,c=e.showNormal,l=e.custom,u=P("g");dt(u,"sjx-svg-wrapper"),dt(u,t.nodeName),n.appendChild(u);var h=t.getBBox(),f=h.width,v=h.height,y=h.x,d=h.y,p=H(t,n),b=P("rect");[["width",f],["height",v],["x",y],["y",d],["fill",ot],["fill-opacity",0],["stroke",ot],["stroke-dasharray","3 3"],["vector-effect","non-scaling-stroke"],["transform",W(p)]].forEach(function(t){var e=mt(t,2),t=e[0],e=e[1];b.setAttribute(t,e)});var x=P("g"),m=P("g"),g=P("g");dt(g,"sjx-svg-box-group"),dt(x,"sjx-svg-handles"),dt(m,"sjx-svg-normal-group"),g.appendChild(b),u.appendChild(g),u.appendChild(m),u.appendChild(x);var _=b.getBBox(),k=_.x,e=_.y,h=_.width,f=_.height,v=t.getAttribute("data-cx"),y=t.getAttribute("data-cy"),w=H(b,b.parentNode),d=kt(w,k+h/2,e+f/2),p=kt(w,k,e),g=kt(w,k+h,e),M=kt(w,k+h,e+f/2),j=kt(w,k,e+f/2),E=kt(w,k+h/2,e),S=kt(w,k+h/2,e+f),h=kt(w,k+h,e+f),k=kt(w,k,e+f),e={tl:p,tr:g,br:h,bl:k,tc:E,bc:S,ml:j,mr:M},f={},h=null;if(a){var A={},T=1;switch(s){case"n":A.x=E.x,A.y=E.y;break;case"s":A.x=S.x,A.y=S.y,T=-1;break;case"w":A.x=j.x,A.y=j.y,T=-1;break;case"e":default:A.x=M.x,A.y=M.y}g="n"===s||"s"===s?Math.atan2(k.y-p.y,k.x-p.x):Math.atan2(p.y-g.y,p.x-g.x),h={x:A.x-i*T*Math.cos(g),y:A.y-i*T*Math.sin(g)},g=c?P("line"):null;c&&(g.x1.baseVal.value=A.x,g.y1.baseVal.value=A.y,g.x2.baseVal.value=h.x,g.y2.baseVal.value=h.y,bt(g,ot),m.appendChild(g));c=null;r&&(c=P("line"),dt(c,"sjx-hidden"),c.x1.baseVal.value=d.x,c.y1.baseVal.value=d.y,c.x2.baseVal.value=v||d.x,c.y2.baseVal.value=y||d.y,bt(c,"#fe3232"),c.setAttribute("opacity",.5),m.appendChild(c)),f={normal:g,radius:c}}var O=V(V({},o&&e),{},{rotator:h,center:r&&a?function(t,e,r){if(ht(e)||ht(r))return null;t=t.createSVGPoint();return t.x=e,t.y=r,t}(n,v,y)||d:void 0});Object.keys(O).forEach(function(t){var e,r,n=O[t];ht(n)||(e=n.x,r=n.y,n="center"===t?"#fe3232":ot,vt(l)&&z(l[t])?O[t]=l[t](w,_,kt):O[t]=lt(e,r,n,t),x.appendChild(O[t]))}),this.storage={wrapper:u,box:b,handles:V(V({},O),f),parent:t.parentNode},yt(u).on("mousedown",this._onMouseDown).on("touchstart",this._onTouchStart)}},{key:"fitTo",value:function(t,e){var r=this.options,n=this.storage,o=n.box;e&&(a=parseFloat(o.getAttribute("height")),parseFloat(t.getAttribute("height"))<a&&t.setAttribute("height",a)),o.setAttribute("height",t.getAttribute("height"));var a=o.getBBox(),t=a.x,a=a.y;ct(n,r,{x:t,y:a,width:parseFloat(o.getAttribute("width")),height:parseFloat(o.getAttribute("height")),boxMatrix:null})}},{key:"_destroy",value:function(){var t=this.storage.wrapper;yt(t).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart),t.parentNode.removeChild(t)}},{key:"_cursorPoint",value:function(t){var e=this.options.container,r=e.getBoundingClientRect(),e=e.getScreenCTM();return e.e=r.x,e.f=r.y,kt(e.inverse(),t.clientX,t.clientY)}},{key:"_pointToElement",value:function(t){var e=t.x,r=t.y,t=this.storage.transform.ctm.inverse();return t.e=t.f=0,this._applyMatrixToPoint(t,e,r)}},{key:"_pointToControls",value:function(t){var e=t.x,r=t.y,t=this.storage.transform.boxCTM.inverse();return t.e=t.f=0,this._applyMatrixToPoint(t,e,r)}},{key:"_applyMatrixToPoint",value:function(t,e,r){var n=this.options.container.createSVGPoint();return n.x=e,n.y=r,n.matrixTransform(t)}},{key:"_apply",value:function(t){var e=this.el,r=this.storage,n=this.options,o=this.options.container,a=r.box,s=r.handles,i=r.cached,c=r.transform,l=c.matrix,u=c.boxCTM,h=c.bBox,f=c.ctm,v=e.getBBox(),y=v.x,d=v.y,c=v.width,v=v.height,y=vt(s.center)?kt(u,s.center.cx.baseVal.value,s.center.cy.baseVal.value):kt(l,y+c/2,d+v/2);if(e.setAttribute("data-cx",y.x),e.setAttribute("data-cy",y.y),!ht(i)){c=i.scaleX,d=i.scaleY,v=i.dx,y=i.dy;if("drag"===t){if(0===v&&0===y)return;i=F();i.e=v,i.f=y;i=i.multiply(l).multiply(i.inverse());n.keepTransformations||(e.setAttribute("transform",W(i)),st(e,{x:v,y:y}))}"resize"===t&&(y=(v=a.getBBox()).x,t=v.y,a=v.width,v=v.height,n.keepTransformations?this.storage.temporalCtm=f:(ct(r,n,{x:y,y:t,width:a,height:v,boxMatrix:null}),it(e,{scaleX:c,scaleY:d,defaultCTM:f,bBox:h,container:o,storage:r,withoutScaling:n.withoutScaling}),e.setAttribute("transform",W(l)))),this.storage.cached=null}}},{key:"_processResize",value:function(t,e){var r=this.el,n=this.storage,o=this.options,a=this.options,s=a.proportions,i=a.processResize,c=a.withoutScaling,l=a.minSize,u=a.allowReversing,h=n.left,f=n.top,v=n.cw,y=n.ch,d=n.transform,p=n.revX,b=n.revY,x=n.doW,m=n.doH,g=d.matrix,_=d.scMatrix,k=d.trMatrix,w=d.scaleX,M=d.scaleY,j=r.getBBox(),a=j.width,d=j.height;r.dataset.temporalWidth&&(a=r.dataset.temporalWidth,d=r.dataset.temporalHeight);j={};i&&(E=i(t,e,p,b),j.fdx=t+(E&&E.x?E.x:0),j.fdy=e+(E&&E.y?E.y:0),t+=E&&E.x?E.x:0,e+=E&&E.y?E.y:0);var E=x||!x&&!m?(v+t)/v:(y+e)/y,a=s?v*E:v+t,d=s?y*E:y+e;if(!(Math.abs(a)<=l||Math.abs(d)<=l||(c||u)&&a<=0||(c||u)&&d<=0)){l=a/v,u=d/y;_.a=l,_.b=0,_.c=0,_.d=u,_.e=0,_.f=0,k.e=w,k.f=M,c&&(t=t<0?Math.abs(t):-Math.abs(t),e=e<0?Math.abs(e):-Math.abs(e),_.a=1,_.b=0,_.c=0,_.d=1,_.e=p?t:0,_.f=b?e:0);k=k.multiply(_).multiply(k.inverse()),k=g.multiply(k);r.setAttribute("transform",W(k)),c&&(r.setAttribute("width",a),r.setAttribute("height",d));p=h-(a-v)*(m?.5:p?1:0),b=f-(d-y)*(x?.5:b?1:0);this.storage.cached={scaleX:l,scaleY:u};j=V({x:p,y:b,width:a,height:d},j);return ct(n,o,V(V({},j),{},{boxMatrix:null})),j}}},{key:"_processMove",value:function(t,e){var r=this.storage,n=r.transform,o=r.wrapper,a=r.center,s=this.options,i=s.processMove,c=s.minStartDistance,l=n.matrix,u=n.trMatrix,h=n.scMatrix,f=n.wrapperMatrix,v=n.parentMatrix;!this.storage.outOfSnap&&c&&Math.abs(t)<c&&Math.abs(e)<c?e=t=0:this.storage.outOfSnap=!0,h.e=t,h.f=e;var y=h.multiply(f);o.setAttribute("transform",W(y)),v.e=v.f=0;var d=kt(v.inverse(),t,e),p=d.x,b=d.y;u.e=p,u.f=b;r=i&&i(p,b);r&&(s=r.x||0,n=r.y||0,h=c=0,v=r.rotation||0,d=Math.cos,i=Math.sin,h={x:(s-c)*d(v=v*Math.PI/180)-(n-h)*i(v)+c,y:(s-c)*i(v)+(n-h)*d(v)+h},y.e+=h.x,y.f+=h.y,o.setAttribute("transform",W(y)),u.e+=r.x||0,u.f+=r.y||0);l=u.multiply(l);return this.el.setAttribute("transform",W(l)),this.storage.cached={dx:p,dy:b,ox:t,oy:e},a.isShifted&&((f=f.inverse()).e=f.f=0,e=(t=kt(f,t,e)).x,t=t.y,this._moveCenterHandle(-e,-t)),l}},{key:"_processRotate",value:function(t){var e=this.storage,r=e.center,n=e.transform,o=e.wrapper,a=n.matrix,s=n.wrapperMatrix,i=n.parentMatrix,c=n.trMatrix,l=n.scMatrix,e=n.rotMatrix,n=_t(Math.cos(t)),t=_t(Math.sin(t));c.e=r.x,c.f=r.y,e.a=n,e.b=t,e.c=-t,e.d=n;s=c.multiply(e).multiply(c.inverse()).multiply(s);o.setAttribute("transform",W(s)),l.e=r.el_x,l.f=r.el_y,i.e=i.f=0;i=i.inverse().multiply(e).multiply(i),a=l.multiply(i).multiply(l.inverse()).multiply(a);return this.el.setAttribute("transform",W(a)),a}},{key:"_getState",value:function(t){var e=t.revX,r=t.revY,n=t.doW,o=t.doH,a=this.el,s=this.storage,i=this.options.container,c=s.box,l=s.wrapper,u=s.parent,h=s.handles.center,f=a.getBBox(),v=f.x,y=f.y,d=f.width,p=f.height,b=c.getBBox(),x=b.width,m=b.height,g=b.x,_=b.y,k=H(a,u),w=s.temporalCtm||H(a,i),t=H(c.parentNode,i),b=H(u,i),s=v+d*(o?.5:e?1:0),u=y+p*(n?.5:r?1:0),l={matrix:k,ctm:w,boxCTM:t,parentMatrix:b,wrapperMatrix:H(l,l.parentNode),trMatrix:F(),scMatrix:F(),rotMatrix:F(),scaleX:s,scaleY:u,scX:Math.sqrt(w.a*w.a+w.b*w.b),scY:Math.sqrt(w.c*w.c+w.d*w.d),bBox:f},s=g+x/2,u=_+m/2,w=h?h.cx.baseVal.value:s,f=h?h.cy.baseVal.value:u,w=kt(t,w,f),f=w.x,w=w.y,y=vt(h)?kt(b.inverse(),f,w):kt(k,v+d/2,y+p/2),p=y.x,y=y.y,s=kt(H(c,i),s,u),u=s.x,s=s.y;return B(a).forEach(function(t){t.__ctm__=H(t,i)}),{transform:l,cw:x,ch:m,center:{x:h?f:u,y:h?w:s,el_x:p,el_y:y,hx:h?h.cx.baseVal.value:null,hy:h?h.cy.baseVal.value:null,isShifted:_t(u,3)!==_t(f,3)&&_t(s,3)!==_t(w,3)},left:g,top:_,revX:e,revY:r,doW:n,doH:o}}},{key:"_moveCenterHandle",value:function(t,e){var r=this.storage,n=r.handles,o=n.center,a=n.radius,n=r.center,r=n.hx,n=n.hy;ht(o)||(t=r+t,e=n+e,o.cx.baseVal.value=t,o.cy.baseVal.value=e,a.x2.baseVal.value=t,a.y2.baseVal.value=e)}},{key:"resetCenterPoint",value:function(){var t=this.storage,e=t.box,r=t.handles,n=r.center,o=r.radius,a=e.getBBox(),s=a.width,t=a.height,r=a.x,a=a.y,e=H(e,e.parentNode),a=kt(e,r+s/2,a+t/2),t=a.x,a=a.y;n.cx.baseVal.value=t,n.cy.baseVal.value=a,n.isShifted=!1,o.x2.baseVal.value=t,o.y2.baseVal.value=a}},{key:"fitControlsToSize",value:function(){var t=this.el,e=this.storage,r=e.box,n=e.wrapper,o=this.options.container,a=t.getBBox(),s=a.width,i=a.height,e=a.x,a=a.y;this.storage.ch=i;o=H(t,o);n.removeAttribute("transform"),r.setAttribute("transform",W(o)),ct(this.storage,this.options,{x:e,y:a,width:s,height:i,boxMatrix:o})}},{key:"controls",get:function(){return this.storage.wrapper}}]),e}(),st=function(e,t){var r=t.x,n=t.y,o=[];switch(e.tagName.toLowerCase()){case"text":var a=vt(e.x.baseVal[0])?e.x.baseVal[0].value+r:(Number(e.getAttribute("x"))||0)+r,s=vt(e.y.baseVal[0])?e.y.baseVal[0].value+n:(Number(e.getAttribute("y"))||0)+n;o.push(["x",a],["y",s]);break;case"use":case"image":case"rect":var i=vt(e.x.baseVal.value)?e.x.baseVal.value+r:(Number(e.getAttribute("x"))||0)+r,c=vt(e.y.baseVal.value)?e.y.baseVal.value+n:(Number(e.getAttribute("y"))||0)+n;o.push(["x",i],["y",c]);break;case"circle":case"ellipse":var l=e.cx.baseVal.value+r,u=e.cy.baseVal.value+n;o.push(["cx",l],["cy",u]);break;case"line":i=e.x1.baseVal.value+r,c=e.y1.baseVal.value+n,l=e.x2.baseVal.value+r,u=e.y2.baseVal.value+n;o.push(["x1",i],["y1",c],["x2",l],["y2",u]);break;case"polygon":case"polyline":var h=I(e.getAttribute("points")).map(function(t){return t[0]=Number(t[0])+r,t[1]=Number(t[1])+n,t.join(" ")}).join(" ");o.push(["points",h]);break;case"path":h=e.getAttribute("d");o.push(["d",function(t){var e=t.path,r=t.dx,n=t.dy;try{for(var o=Mt(e),a="",s=" ",i=!0,c=0,l=o.length;c<l;c++){var u=o[c],h=u.values,f=u.key,v=u.relative,y=[];switch(f){case"M":for(var d=0,p=h.length;d<p;d+=2){var b=mt(h.slice(d,d+2),2),x=b[0],b=b[1];v&&!i||(x+=r,b+=n),y.push(x,b),i=!1}break;case"A":for(var m=0,g=h.length;m<g;m+=7){var _=h.slice(m,m+7);v||(_[5]+=r,_[6]+=n),y.push.apply(y,L(_))}break;case"C":for(var k=0,w=h.length;k<w;k+=6){var M=h.slice(k,k+6);v||(M[0]+=r,M[1]+=n,M[2]+=r,M[3]+=n,M[4]+=r,M[5]+=n),y.push.apply(y,L(M))}break;case"H":for(var j=0,E=h.length;j<E;j+=1){var S=h.slice(j,j+1);v||(S[0]+=r),y.push(S[0])}break;case"V":for(var A=0,T=h.length;A<T;A+=1){var O=h.slice(A,A+1);v||(O[0]+=n),y.push(O[0])}break;case"L":case"T":for(var V=0,z=h.length;V<z;V+=2){var C=mt(h.slice(V,V+2),2),D=C[0],C=C[1];v||(D+=r,C+=n),y.push(D,C)}break;case"Q":case"S":for(var R=0,X=h.length;R<X;R+=4){var Y=mt(h.slice(R,R+4),4),N=Y[0],P=Y[1],B=Y[2],Y=Y[3];v||(N+=r,P+=n,B+=r,Y+=n),y.push(N,P,B,Y)}break;case"Z":s=h[0]=""}a+=u.cmd+y.join(",")+s}return a}catch(t){gt("Path parsing error: "+t)}}({path:h,dx:r,dy:n})])}o.forEach(function(t){e.setAttribute(t[0],t[1])})},it=function(r,t){var e=t.scaleX,n=t.scaleY,o=t.bBox,a=t.defaultCTM,s=t.container,i=t.withoutScaling,c=o.width,l=o.height,u=[],s=H(r,s),h=a.inverse().multiply(s);switch(r.tagName.toLowerCase()){case"text":var f=vt(r.x.baseVal[0])?r.x.baseVal[0].value:Number(r.getAttribute("x"))||0,v=vt(r.y.baseVal[0])?r.y.baseVal[0].value:Number(r.getAttribute("y"))||0,f=kt(h,f,v),v=f.x,f=f.y;u.push(["x",v+(e<0?c:0)],["y",f+(n<0?l:0)]);break;case"circle":var y=r.r.baseVal.value,d=r.cx.baseVal.value,p=r.cy.baseVal.value,y=y*(Math.abs(e)+Math.abs(n))/2,d=kt(h,d,p),p=d.x,d=d.y;u.push(["r",y],["cx",p],["cy",d]);break;case"image":case"foreignobject":case"rect":var y=r.width.baseVal.value,b=r.height.baseVal.value,p=r.x.baseVal.value,d=r.y.baseVal.value,p=kt(h,p,d),d=p.x,p=p.y,y=Math.abs(y*e),b=Math.abs(b*n);u.push(["x",d-(e<0?y:0)],["y",p-(n<0?b:0)]),i||(r.dataset.scale=e,u.push(["width",y],["height",b]));break;case"ellipse":var x=r.rx.baseVal.value,m=r.ry.baseVal.value,g=r.cx.baseVal.value,_=r.cy.baseVal.value,b=kt(h,g,_),g=b.x,_=b.y,b=F();b.a=e,b.d=n;x=kt(b,x,m),m=x.x,x=x.y;u.push(["rx",Math.abs(m)],["ry",Math.abs(x)],["cx",g],["cy",_]);break;case"line":m=r.x1.baseVal.value,x=r.y1.baseVal.value,g=r.x2.baseVal.value,_=r.y2.baseVal.value,m=kt(h,m,x),x=m.x,m=m.y,g=kt(h,g,_),_=g.x,g=g.y;u.push(["x1",x],["y1",m],["x2",_],["y2",g]);break;case"polygon":case"polyline":var k=I(r.getAttribute("points")).map(function(t){var e=kt(h,Number(t[0]),Number(t[1])),r=e.x,e=e.y;return t[0]=r,t[1]=e,t.join(" ")}).join(" ");u.push(["points",k]);break;case"path":k=r.getAttribute("d");u.push(["d",function(t){var e=t.path,r=t.localCTM;try{for(var n=Mt(e),o="",a=" ",s=[],i=!0,c=0,l=n.length;c<l;c++){var u=n[c],h=u.values,f=u.key,v=u.relative;switch(f){case"A":for(var y=[],d=0,p=h.length;d<p;d+=7){var b=mt(h.slice(d,d+7),7),x=b[0],m=b[1],g=b[2],_=b[3],k=b[4],w=b[5],M=b[6],b=wt(r);v&&(b.e=b.f=0);w=kt(b,w,M),M=w.x,w=w.y;y.push(_t(M),_t(w)),b.e=b.f=0;x=kt(b,x,m),m=x.x,x=x.y;y.unshift(_t(m),_t(x),g,_,k)}s.push(y);break;case"C":for(var j=[],E=0,S=h.length;E<S;E+=6){var A=mt(h.slice(E,E+6),6),T=A[0],O=A[1],V=A[2],z=A[3],C=A[4],D=A[5],A=wt(r);v&&(A.e=A.f=0);T=kt(A,T,O),O=T.x,T=T.y,V=kt(A,V,z),z=V.x,V=V.y,C=kt(A,C,D),D=C.x,C=C.y;j.push(_t(O),_t(T),_t(z),_t(V),_t(D),_t(C))}s.push(j);break;case"H":for(var R=[],X=0,Y=h.length;X<Y;X+=1){var N=mt(h.slice(X,X+1),1)[0],P=wt(r);v&&(P.e=P.f=0);N=kt(P,N,0).x;R.push(_t(N))}s.push(R);break;case"V":for(var B=[],L=0,F=h.length;L<F;L+=1){var H=mt(h.slice(L,L+1),1)[0],W=wt(r);v&&(W.e=W.f=0);H=kt(W,0,H).y;B.push(_t(H))}s.push(B);break;case"T":case"L":for(var I=[],q=0,U=h.length;q<U;q+=2){var G=mt(h.slice(q,q+2),2),Q=G[0],Z=G[1],G=wt(r);v&&(G.e=G.f=0);Q=kt(G,Q,Z),Z=Q.x,Q=Q.y;I.push(_t(Z),_t(Q))}s.push(I);break;case"M":for(var $=[],J=0,K=h.length;J<K;J+=2){var tt=mt(h.slice(J,J+2),2),et=tt[0],rt=tt[1],tt=wt(r);v&&!i&&(tt.e=tt.f=0);et=kt(tt,et,rt),rt=et.x,et=et.y;$.push(_t(rt),_t(et)),i=!1}s.push($);break;case"Q":for(var nt=[],ot=0,at=h.length;ot<at;ot+=4){var st=mt(h.slice(ot,ot+4),4),it=st[0],ct=st[1],lt=st[2],ut=st[3],st=wt(r);v&&(st.e=st.f=0);it=kt(st,it,ct),ct=it.x,it=it.y,lt=kt(st,lt,ut),ut=lt.x,lt=lt.y;nt.push(_t(ct),_t(it),_t(ut),_t(lt))}s.push(nt);break;case"S":for(var ht=[],ft=0,vt=h.length;ft<vt;ft+=4){var yt=mt(h.slice(ft,ft+4),4),dt=yt[0],pt=yt[1],bt=yt[2],xt=yt[3],yt=wt(r);v&&(yt.e=yt.f=0);dt=kt(yt,dt,pt),pt=dt.x,dt=dt.y,bt=kt(yt,bt,xt),xt=bt.x,bt=bt.y;ht.push(_t(pt),_t(dt),_t(xt),_t(bt))}s.push(ht);break;case"Z":s.push([""]),a=""}o+=u.cmd+s[c].join(",")+a}return o}catch(t){gt("Path parsing error: "+t)}}({path:k,localCTM:h})])}u.forEach(function(t){var e=mt(t,2),t=e[0],e=e[1];r.setAttribute(t,e)})},ct=function(t,e,r){var n=e.rotatable,o=e.rotatorAnchor,a=e.rotatorOffset,s=t.box,i=t.handles,c=t.center,l=r.x,u=r.y,h=r.width,f=r.height,v=r.boxMatrix,e=h/2,t=f/2,r=null!==v?v:H(s,s.parentNode),v=kt(r,l+e,u+t),y={tl:kt(r,l,u),tr:kt(r,l+h,u),br:kt(r,l+h,u+f),bl:kt(r,l,u+f),tc:kt(r,l+e,u),bc:kt(r,l+e,u+f),ml:kt(r,l,u+t),mr:kt(r,l+h,u+t),center:vt(i.center)&&!c.isShifted?v:void 0};if(n){var d={},p=1;switch(o){case"n":d.x=y.tc.x,d.y=y.tc.y;break;case"s":d.x=y.bc.x,d.y=y.bc.y,p=-1;break;case"w":d.x=y.ml.x,d.y=y.ml.y,p=-1;break;case"e":default:d.x=y.mr.x,d.y=y.mr.y}n="n"===o||"s"===o?Math.atan2(y.bl.y-y.tl.y,y.bl.x-y.tl.x):Math.atan2(y.tl.y-y.tr.y,y.tl.x-y.tr.x),o={x:d.x-a*p*Math.cos(n),y:d.y-a*p*Math.sin(n)},a=i.normal,n=i.radius;vt(a)&&(a.x1.baseVal.value=d.x,a.y1.baseVal.value=d.y,a.x2.baseVal.value=o.x,a.y2.baseVal.value=o.y),vt(n)&&(n.x1.baseVal.value=v.x,n.y1.baseVal.value=v.y,c.isShifted||(n.x2.baseVal.value=v.x,n.y2.baseVal.value=v.y)),y.rotator=o}var b={x:l+=h<0?h:0,y:u+=f<0?f:0,width:Math.abs(h),height:Math.abs(f)};Object.keys(b).forEach(function(t){s.setAttribute(t,b[t])}),Object.keys(y).forEach(function(t){var e=i[t],t=y[t];ht(t)||ht(e)||("g"===e.tagName||"path"===e.tagName?e.instance&&"path"===e.tagName?e.instance.transform({x:t.x,y:t.y}):e.setAttribute("transform","matrix(1, 0, 0, 1, ".concat(t.x,", ").concat(t.y,")")):(e.setAttribute("cx",t.x),e.setAttribute("cy",t.y)))})},lt=function(t,e,r,n){var o=P("circle");dt(o,"sjx-svg-hdl-".concat(n));var a={cx:t,cy:e,r:5.5,fill:r,stroke:"#fff","fill-opacity":1,"vector-effect":"non-scaling-stroke","stroke-width":1};return Object.keys(a).map(function(t){o.setAttribute(t,a[t])}),o},bt=function(t,e){t.setAttribute("stroke",e),t.setAttribute("stroke-dasharray","3 3"),t.setAttribute("vector-effect","non-scaling-stroke")};function xt(r,t){if(this.length){var n=vt(t)&&t instanceof w?t:new w;return b.call(this,function(t,e){return e instanceof SVGElement?function(t){t=t.tagName.toLowerCase();return-1!==N.indexOf(t)||(gt("Selected element "+t+" is not allowed to transform. Allowed elements:\n"+"circle, ellipse, image, line, path, polygon, polyline, rect, text, g, foreignObject"),!1)}(e)&&t.push(new at(e,r,n)):t.push(new tt(e,r,n)),t},[])}}var jt=function(){s(n,O);var r=u(n);function n(t,e){return i(this,n),(t=r.call(this,t)).enable(e),t}return c(n,[{key:"_init",value:function(){var e=this,t=this.el,r=this.options,n=yt(t),t=r.style,r=r.appendTo,t=V({position:"absolute","z-index":"2147483647"},t);this.storage={css:t,parent:vt(r)?yt(r)[0]:document.body},n.on("mousedown",this._onMouseDown).on("touchstart",this._onTouchStart),D.slice(0,3).forEach(function(t){e.eventDispatcher.registerEvent(t)})}},{key:"_processOptions",value:function(t){var e,r,n,o,a,c,l,s={},i=null,u=document,h=function(){},f=function(){},v=function(){},y=function(){};vt(t)&&(e=t.style,r=t.appendTo,n=t.stack,o=t.onInit,a=t.onMove,c=t.onDrop,t=t.onDestroy,s=vt(e)&&"object"===ut(e)?e:s,i=r||null,l=vt(n)?yt(n)[0]:document,h=ft(o),f=ft(a),v=z(c)?function(t){var e,r,n,o,a,s,i=this.storage.clone;(r=l,n=j(e=i),o=n.top,a=n.left,s=j(r),n=s.top,s=s.left,e=yt(e),r=yt(r),o<n||o+parseFloat(e.css("height"))>n+parseFloat(r.css("height"))||a<s||a+parseFloat(e.css("width"))>s+parseFloat(r.css("width")))||c.call(this,t,this.el,i)}:function(){},y=ft(t)),this.options={style:s,appendTo:i,stack:u},this.proxyMethods={onInit:h,onDrop:v,onMove:f,onDestroy:y}}},{key:"_start",value:function(t){var e=t.clientX,r=t.clientY,n=this.storage,o=this.el,a=n.parent,s=n.css,i=j(a),t=i.left,i=i.top;s.left="".concat(e-t,"px"),s.top="".concat(r-i,"px");o=o.cloneNode(!0);yt(o).css(s),n.clientX=e,n.clientY=r,n.cx=e,n.cy=r,n.clone=o,yt(a)[0].appendChild(o),this._draw()}},{key:"_moving",value:function(t){var e=t.clientX,r=t.clientY,t=this.storage;t.clientX=e,t.clientY=r,t.doDraw=!0,t.doMove=!0}},{key:"_end",value:function(t){var e=this.storage,r=e.clone,n=e.frameId;e.doDraw=!1,v(n),ht(r)||(this.proxyMethods.onDrop.call(this,t),r.parentNode.removeChild(r),delete e.clone)}},{key:"_animate",value:function(){var t=this.storage;t.frameId=A(this._animate);var e=t.doDraw,r=t.clientX,n=t.clientY,o=t.cx,a=t.cy;e&&(t.doDraw=!1,this._drag({dx:r-o,dy:n-a}))}},{key:"_processMove",value:function(t,e){var r=this.storage.clone,e="translate(".concat(t,"px, ").concat(e,"px)");yt(r).css({transform:e,webkitTranform:e,mozTransform:e,msTransform:e,otransform:e})}},{key:"_destroy",value:function(){var t=this.storage,e=this.proxyMethods,r=this.el;ht(t)||(yt(r).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart),e.onDestroy.call(this,r),delete this.storage)}},{key:"disable",value:function(){this._destroy()}}]),n}();function Et(e){if(this.length)return p.call(this,function(t){return new jt(t,e)})}var St=function(){s(e,x);var t=u(e);function e(){return i(this,e),t.apply(this,arguments)}return c(e,[{key:"drag",value:function(){return xt.call.apply(xt,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"clone",value:function(){return Et.call.apply(Et,[this].concat(Array.prototype.slice.call(arguments)))}}]),e}();function At(t){return new St(t)}return Object.defineProperty(At,"createObservable",{value:function(){return new w}}),Object.defineProperty(At,"Subjx",{value:St}),Object.defineProperty(At,"Observable",{value:w}),At});
